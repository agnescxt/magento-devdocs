<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>支付令牌 | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">

	<link rel="stylesheet" href="/assets/css/app.css" />
	<link rel="stylesheet" href="/assets/css/print.css" media="print"/>

	<link rel="stylesheet" href="/common/css/devdocs.css" />

	<script>
  var baseUrl = "";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c"
  };
</script>




	<link rel="canonical" href="http://localhost:4000/guides/v2.3/payments-integrations/vault/payment-token.html">

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">

	<header class="site-header">

		<nav class="site-nav">

  <div class="menu-btn">
    <a id="menu-btn" class="menu-trigger menu-icon" href="#nav-main" aria-haspopup="true" aria-controls="nav-main"></a>
  </div>

  <div class="nav-container">

    <a class="logo" href="/guides/v2.3/">
      <img src="/assets/i/m-logo.svg" alt=""><img src="/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      
<div class="version-switcher dropdown" data-version="2.3">
	<button id="version-switcher-button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Magento 2.3 Pre-release
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.0/payments-integrations/vault/payment-token.html">Magento 2.0</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.1/payments-integrations/vault/payment-token.html">Magento 2.1</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.2/payments-integrations/vault/payment-token.html">Magento 2.2</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.3/payments-integrations/vault/payment-token.html">Magento 2.3 Pre-release</a></li>
	
  </ul>

</div>


      <!-- Main Navigation -->
<ul class="nav-main" role="menubar">

  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">部署</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          <li><a href="/guides/v2.3/install-gde/bk-install-guide.html">安装向导</a></li>
          
          <li><a href="/guides/v2.3/config-guide/bk-config-guide.html">配置手册</a></li>
          
          <li><a href="/guides/v2.3/performance-best-practices/index.html">高效实践</a></li>
          
          <li><a href="/guides/v2.3/migration/bk-migration-guide.html">迁移指引</a></li>
          <li><a href="/guides/v2.3/cloud/bk-cloud.html">上云指引</a></li>
          <li><a href="/magento-release-information.html">版本日志</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">开发</span>

    <div class="nav-popup" role="menu" aria-hidden="true">

      <div class="nav-section">
        <div class="nav-section-title">服务端</div>
        <ul>
          <li><a href="/guides/v2.3/architecture/bk-architecture.html">架构说明</a></li>
          <li><a href="/guides/v2.3/extension-dev-guide/bk-extension-dev-guide.html">PHP开发文档</a></li>
          <li><a href="/guides/v2.3/ext-best-practices/bk-ext-best-practices.html">扩展开发实践</a></li>
          <li><a href="/guides/v2.3/mrg/intro.html">各模块介绍</a></li>
          <li><a href="/guides/v2.3/coding-standards/bk-coding-standards.html">编码规范</a></li>
          <li><a href="/guides/v2.3/contributor-guide/contributing.html">贡献指引</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">前端</div>
        <ul>
          <li class=""><a href="/guides/v2.3/frontend-dev-guide/bk-frontend-dev-guide.html">前端工程师手册</a></li>
          
          <li><a href="/guides/v2.3/ui_comp_guide/bk-ui_comps.html">UI组件手册</a></li>
          
          <li><a href="/guides/v2.3/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript开发手册</a></li>
          <li><a href="/guides/v2.3/pattern-library/bk-pattern.html">管理面板设计模式及所用库</a></li>
          <li><a href="/guides/v2.3/design-styleguide/bk-styleguide.html">管理面板样式手册</a></li>
          <li><a href="https://magento-research.github.io/pwa-devdocs/">PWA Studios</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title"><abbr>API</abbr></div>
        <ul>
          <li><a href="/guides/v2.3/get-started/bk-get-started-api.html">Web APIs起步</a></li>
          <li><a href="/guides/v2.3/rest/bk-rest.html">REST API参考</a></li>
          <li><a href="/guides/v2.3/soap/bk-soap.html">SOAP API参考</a></li>
          
          <li><a href="/guides/v2.3/graphql/index.html">GraphQL开发者手册(新!)</a></li>
          
          
          <li><a href="/guides/v2.3/marketplace/eqp/api.html">Marketplace EQP API Reference</a></li>
          
        </ul>
      </div>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">测试</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.3/test/testing.html">Magento测试手册</a></li>
        
        <li><a href="/guides/v2.3/magento-functional-testing-framework/release-2/introduction.html">功能验收测试(新!)</a></li>
        
        <li><a href="/guides/v2.3/mtf/mtf_introduction.html">功能测试</a></li>
        <li><a href="/guides/v2.3/test/integration/integration_test_execution.html">集成测试</a></li>
        <li><a href="/guides/v2.3/test/js/jasmine.html">JavaScript单元测试</a></li>
        <li><a href="/guides/v2.3/test/unit/unit_test_execution.html">PHP单元测试</a></li>
        <li><a href="/guides/v2.3/get-started/web-api-functional-testing.html">Web API功能测试</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-separator"></li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">功能文档</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          
          <li class="leaf"><a href="/guides/v2.3/advanced-reporting/overview.html">高级报表</a></li>
          
        
        <li class="leaf"><a href="/guides/v2.3/b2b/bk-b2b.html">B2B</a></li>
        
        <li><a href="/guides/v2.3/howdoi/checkout/checkout_overview.html">Checkout</a></li>
        <li><a href="/guides/v2.3/payments-integrations/bk-payments-integrations.html">支付集成</a></li>
        
          <li><a href="/guides/v2.3/extension-dev-guide/staging.html">Staging</a></li>
        
      </ul>
    </div>

  </li>


  <li class="nav-main-item"  tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">指引</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.3/howdoi/bk-how-do-i.html">如何</a></li>
        
        <li><a  data-proofer-ignore href="/guides/v2.3/get-started/order-tutorial/order-intro.html">使用EST APIs处理订单</a></li>
        

        <li><a href="/videos/">视频教程</a></li>
      </ul>
    </div>

  </li>

</ul><!-- /.nav-main -->

    </div>

    <div class="search-btn">
      <a class="search-trigger search-icon" href="#"></a>
    </div>

    <form class="quick-search" action="/guides/v2.3/search.html" method="get" novalidate="novalidate">
      <input type="search" name="q" placeholder="Search" />
      <a href="#" class="quick-search-close">&times;</a>
    </form>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" data-proofer-ignore class="toc-toggler">内容表格</a>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">支付提供商网关</h4>
		<div class="collapsible-navigation">
		    <ul>
		    
		    	

<li class="nav-level1  " id="介绍">
    

    
    <a href="/guides/v2.3/payments-integrations/bk-payments-integrations.html">介绍</a>
    

    
</li>


		    
		    	

<li class="nav-level1  " id="magento支付提供商网关">
    

    
    <a href="/guides/v2.3/payments-integrations/payment-gateway/payment-gateway-intro.html">Magento支付提供商网关</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="支付提供商网关结构">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/payment-gateway-structure.html">支付提供商网关结构</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="网关命令">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/gateway-command.html">网关命令</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="网关命令池">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/command-pool.html">网关命令池</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="请求构造器">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/request-builder.html">请求构造器</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="网关客户端">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/gateway-client.html">网关客户端</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="响应校验器">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/response-validator.html">响应校验器</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="响应处理器">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/response-handler.html">响应处理器</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="错误码映射">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/error-code-mapper.html">错误码映射</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="添加一个新的支付集成(支付方式)">
    

    
    <a href="/guides/v2.3/payments-integrations/base-integration/integration-intro.html">添加一个新的支付集成(支付方式)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="支集模块配置">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/module-configuration.html">支集模块配置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="支集方式配置">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/payment-option-config.html">支集方式配置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="支集方式外观接口">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/facade-configuration.html">支集方式外观接口</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="管理面板的支付信息渲染">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/formblocktype.html">管理面板的支付信息渲染</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="添加支付动作">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/payment-action.html">添加支付动作</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="从前台获取支付信息到后台">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/get-payment-info.html">从前台获取支付信息到后台</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="根据地区配置支付方法">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/admin-integration.html">根据地区配置支付方法</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="添加vault集成">
    

    
    <a href="/guides/v2.3/payments-integrations/vault/vault-intro.html">添加vault集成</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="添加vault到模块依赖">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/module-configuration.html">添加vault到模块依赖</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault支付配置">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/vault-payment-configuration.html">vault支付配置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault依赖注入配置">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/vault-di.html">vault依赖注入配置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="启用vault">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/enabler.html">启用vault</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2 active " id="支付令牌">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/payment-token.html">支付令牌</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="token-ui-component-provider">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/token-ui-component-provider.html">令牌UI组件提供器</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="显示存储的信息">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/customer-stored-payments.html">显示存储的信息</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault管理面板实现">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/admin-integration.html">vault管理面板实现</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="signifyd欺诈保护">
    

    
    <a href="/guides/v2.3/payments-integrations/signifyd/signifyd.html">Signifyd欺诈保护</a>
    

    
</li>


		    
		    </ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

  <nav class="breadcrumbs">

    <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      <li class="breadcrumb-item"><a class="breadcrumb-item" href="/guides/v2.3/"><span>首页</span></a></li>

    <!-- Iteration breadcrumb item -->
    
    

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item active" property="itemListElement" typeof="ListItem">

        

          

          <span property="name">支付令牌</span>

        

        <meta property="position" content="1" />
      </li>

    

    </ol>

  </nav>



	

	

	<h1 class="page-heading">支付令牌</h1>

  


</section>

			<p>Magento does not store any private credit card details. It only stores the data received from the payment provider: payment processor token and credit card details without sensitive data.</p>

<p>This information is stored in 支付令牌.</p>

<p>The basic interface for 支付令牌 is <a href="https://github.com/magento/magento2/blob/2.1//app/code/Magento/Vault/Api/Data/PaymentTokenInterface.php">PaymentTokenInterface</a>.</p>

<p>To retrieve and store token details, you need to implement a <a href="/guides/v2.3/payments-integrations/payment-gateway/response-handler.html">response handler</a>. In the response handler a 支付令牌 <span term-uuid="a9027f5d-efab-4662-96aa-c2999b5ab259" class="glossary-term" data-toggle="popover">entity</span> is created and stored in the payment <span term-uuid="55774db9-bf9d-40f3-83db-b10cc5ae3b68" class="glossary-term" data-toggle="popover">extension</span> attributes.</p>

<p>Following sample is an example of the response handler implementation:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">use</span> <span class="nx">Magento\Vault\Api\Data\PaymentTokenFactoryInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Vault\Api\Data\PaymentTokenInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">VaultDetailsHandler</span> <span class="k">implements</span> <span class="nx">HandlerInterface</span>
<span class="p">{</span>
    <span class="sd">/**
     * @inheritdoc
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="k">array</span> <span class="nv">$handlingSubject</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$paymentDO</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">subjectReader</span><span class="o">-&gt;</span><span class="na">readPayment</span><span class="p">(</span><span class="nv">$handlingSubject</span><span class="p">);</span>
        <span class="nv">$transaction</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">subjectReader</span><span class="o">-&gt;</span><span class="na">readTransaction</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
        <span class="nv">$payment</span> <span class="o">=</span> <span class="nv">$paymentDO</span><span class="o">-&gt;</span><span class="na">getPayment</span><span class="p">();</span>

        <span class="c1">// add vault payment token entity to extension attributes
</span>        <span class="nv">$paymentToken</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getVaultPaymentToken</span><span class="p">(</span><span class="nv">$transaction</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">!==</span> <span class="nv">$paymentToken</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$extensionAttributes</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getExtensionAttributes</span><span class="p">(</span><span class="nv">$payment</span><span class="p">);</span>
            <span class="nv">$extensionAttributes</span><span class="o">-&gt;</span><span class="na">setVaultPaymentToken</span><span class="p">(</span><span class="nv">$paymentToken</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Get vault payment token entity
     *
     * @param \Braintree\Transaction $transaction
     * @return PaymentTokenInterface|null
     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">getVaultPaymentToken</span><span class="p">(</span><span class="nx">Transaction</span> <span class="nv">$transaction</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Check token existing in gateway response
</span>        <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">creditCardDetails</span><span class="o">-&gt;</span><span class="na">token</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$token</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="sd">/** @var PaymentTokenInterface $paymentToken */</span>
        <span class="nv">$paymentToken</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentTokenFactory</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nx">PaymentTokenFactoryInterface</span><span class="o">::</span><span class="na">TOKEN_TYPE_CREDIT_CARD</span><span class="p">);</span>
        <span class="nv">$paymentToken</span><span class="o">-&gt;</span><span class="na">setGatewayToken</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>

        <span class="nv">$paymentToken</span><span class="o">-&gt;</span><span class="na">setTokenDetails</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">convertDetailsToJSON</span><span class="p">([</span>
            <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getCreditCardType</span><span class="p">(</span><span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">creditCardDetails</span><span class="o">-&gt;</span><span class="na">cardType</span><span class="p">),</span>
            <span class="s1">'maskedCC'</span> <span class="o">=&gt;</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">creditCardDetails</span><span class="o">-&gt;</span><span class="na">last4</span><span class="p">,</span>
            <span class="s1">'expirationDate'</span> <span class="o">=&gt;</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">creditCardDetails</span><span class="o">-&gt;</span><span class="na">expirationDate</span>
        <span class="p">]));</span>

        <span class="k">return</span> <span class="nv">$paymentToken</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There are two available types of payment tokens:</p>

<ul>
  <li><code class="highlighter-rouge">\Magento\Vault\Api\Data\PaymentTokenFactoryInterface::TOKEN_TYPE_CREDIT_CARD</code> is used for credit cards</li>
  <li><code class="highlighter-rouge">\Magento\Vault\Api\Data\PaymentTokenFactoryInterface::TOKEN_TYPE_ACCOUNT</code> is used for payment accounts like PayPal</li>
</ul>

<p>Depending on your payment integration, you need to specify one of them to create a payment token.</p>

<p>Also, you can create own type of payment token.
But in that case you must re-define the <code class="highlighter-rouge">tokenTypes</code> argument for <code class="highlighter-rouge">\Magento\Vault\Model\PaymentTokenFactory</code> in <code class="highlighter-rouge">di.xml</code> (not just replacing with argument but appending your token type to existing to avoid breaking existing functionality) or provide own preference for <code class="highlighter-rouge">\Magento\Vault\Api\Data\PaymentTokenFactoryInterface</code>.</p>

<p>The important thing is the <code class="highlighter-rouge">setGatewayToken()</code> method. This method gets the gateway token: a hashed value based on some credit card details.
Different payment providers use different algorithms to create this hash. In most cases, exactly this token is used to perform place order actions.</p>

<p>The created response handler must be added to the handler chain in the DI configuration file <code class="highlighter-rouge">di.xml</code>.</p>

<p>Example of the Braintriee <code class="highlighter-rouge">di.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"BraintreeAuthorizationHandler"</span> <span class="na">type=</span><span class="s">"Magento\Payment\Gateway\Response\HandlerChain"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"handlers"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
            ...
            <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"vault_details"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>Magento\Braintree\Gateway\Response\VaultDetailsHandler<span class="nt">&lt;/item&gt;</span>
            ...
        <span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/virtualType&gt;</span>
</code></pre></div></div>

<p>The persistence layer for 支付令牌 is implemented in the <a href="https://github.com/magento/magento2/blob/2.1/app/code/Magento/Vault">Vault Module</a>.</p>

<h2 id="whats-next">What’s next</h2>
<p><a href="/guides/v2.3/payments-integrations/vault/token-ui-component-provider.html">Adding and using  UI_Vault component to place orders on the storefront</a>.</p>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

    
  
    
    <div class="github-link">
      <a class="improve-page" href="https://github.com/magento/devdocs/blob/develop/guides/v2.3/payments-integrations/vault/payment-token.md" target="_blank">
        去GitHub上编辑
      </a>
    </div>
    
  
    
    <div class="new-issue">
      <a href="https://github.com/magento/devdocs/issues/new?title=Feedback on page: /guides/v2.3/payments-integrations/vault/payment-token.html" target="_blank">反馈</a>
    </div>
    
  
  </div>

	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav footer-links">
  <li><a href="/guides/v2.3/contributor-guide/contributing_docs.html">成为贡献者</a>
  <li><a href="https://magento.github.io/glossary/index.html?audience=developer">术语表</a></li>
  <li><a href="http://magento.com/legal/terms/privacy/">隐私政策</a></li>
  <li><a href="http://magento.com/legal/terms/">服务条款</a></li>
  <li><a href="http://magento.com/legal/licensing/">许可/商标 常见问题</a></li>
  <li><a href="/guides/v2.3/release-notes/bk-release-notes.html">版本日志</a></li>
  <li><a href="/magento-third-party.html">三方许可</a></li>
</ul>

    </div>

		<div class="copyright-date">&copy; 2018 Magento. All rights reserved. translated by <a target="_blank" href="https://www.silksoftware.com">silksoftware co.ltd</a> - <a href="http://haiwera.xyz">Haiwera</a></div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/assets/js/app.min.js"></script>


<script src="/common/js/devdocs.min.js"></script>




</body>
</html>

