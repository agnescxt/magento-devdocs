<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>手动配置主数据库 | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">

	<link rel="stylesheet" href="/assets/css/app.css" />
	<link rel="stylesheet" href="/assets/css/print.css" media="print"/>

	<link rel="stylesheet" href="/common/css/devdocs.css" />

	<script>
  var baseUrl = "";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c"
  };
</script>




	<link rel="canonical" href="http://localhost:4000/guides/v2.2/config-guide/multi-master/multi-master_manual.html">

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">

	<header class="site-header">

		<nav class="site-nav">

  <div class="menu-btn">
    <a id="menu-btn" class="menu-trigger menu-icon" href="#nav-main" aria-haspopup="true" aria-controls="nav-main"></a>
  </div>

  <div class="nav-container">

    <a class="logo" href="/">
      <img src="/assets/i/m-logo.svg" alt=""><img src="/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      
<div class="version-switcher dropdown" data-version="2.2">
	<button id="version-switcher-button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Magento 2.2
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.0/config-guide/multi-master/multi-master_manual.html">Magento 2.0</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.1/config-guide/multi-master/multi-master_manual.html">Magento 2.1</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.2/config-guide/multi-master/multi-master_manual.html">Magento 2.2</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.3/config-guide/multi-master/multi-master_manual.html">Magento 2.3 Pre-release</a></li>
	
  </ul>

</div>


      <!-- Main Navigation -->
<ul class="nav-main" role="menubar">

  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">部署</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          <li><a href="/guides/v2.2/install-gde/bk-install-guide.html">安装向导</a></li>
          
          <li><a href="/guides/v2.2/comp-mgr/bk-compman-upgrade-guide.html">扩展安装及系统升级手册</a></li>
          
          <li><a href="/guides/v2.2/config-guide/bk-config-guide.html">配置手册</a></li>
          
          <li><a href="/guides/v2.2/performance-best-practices/index.html">高效实践</a></li>
          
          <li><a href="/guides/v2.2/migration/bk-migration-guide.html">迁移指引</a></li>
          <li><a href="/guides/v2.2/cloud/bk-cloud.html">上云指引</a></li>
          <li><a href="/magento-release-information.html">版本日志</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">开发</span>

    <div class="nav-popup" role="menu" aria-hidden="true">

      <div class="nav-section">
        <div class="nav-section-title">服务端</div>
        <ul>
          <li><a href="/guides/v2.2/architecture/bk-architecture.html">架构说明</a></li>
          <li><a href="/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">PHP开发文档</a></li>
          <li><a href="/guides/v2.2/ext-best-practices/bk-ext-best-practices.html">扩展开发实践</a></li>
          <li><a href="/guides/v2.2/mrg/intro.html">各模块介绍</a></li>
          <li><a href="/guides/v2.2/coding-standards/bk-coding-standards.html">编码规范</a></li>
          <li><a href="/guides/v2.2/contributor-guide/contributing.html">贡献指引</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">前端</div>
        <ul>
          <li class=""><a href="/guides/v2.2/frontend-dev-guide/bk-frontend-dev-guide.html">前端工程师手册</a></li>
          
          <li><a href="/guides/v2.2/ui_comp_guide/bk-ui_comps.html">UI组件手册</a></li>
          
          <li><a href="/guides/v2.2/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript开发手册</a></li>
          <li><a href="/guides/v2.2/pattern-library/bk-pattern.html">管理面板设计模式及所用库</a></li>
          <li><a href="/guides/v2.2/design-styleguide/bk-styleguide.html">管理面板样式手册</a></li>
          <li><a href="https://magento-research.github.io/pwa-devdocs/">PWA Studios</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title"><abbr>API</abbr></div>
        <ul>
          <li><a href="/guides/v2.2/get-started/bk-get-started-api.html">Web APIs起步</a></li>
          <li><a href="/guides/v2.2/rest/bk-rest.html">REST API参考</a></li>
          <li><a href="/guides/v2.2/soap/bk-soap.html">SOAP API参考</a></li>
          
          
          <li><a href="/guides/v2.2/marketplace/eqp/api.html">Marketplace EQP API Reference</a></li>
          
        </ul>
      </div>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">测试</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.2/test/testing.html">Magento测试手册</a></li>
        
        <li><a href="/guides/v2.2/magento-functional-testing-framework/release-2/introduction.html">功能验收测试(新!)</a></li>
        
        <li><a href="/guides/v2.2/mtf/mtf_introduction.html">功能测试</a></li>
        <li><a href="/guides/v2.2/test/integration/integration_test_execution.html">集成测试</a></li>
        <li><a href="/guides/v2.2/test/js/jasmine.html">JavaScript单元测试</a></li>
        <li><a href="/guides/v2.2/test/unit/unit_test_execution.html">PHP单元测试</a></li>
        <li><a href="/guides/v2.2/get-started/web-api-functional-testing.html">Web API功能测试</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-separator"></li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">功能文档</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          
          <li class="leaf"><a href="/guides/v2.2/advanced-reporting/overview.html">高级报表</a></li>
          
        
        <li class="leaf"><a href="/guides/v2.2/b2b/bk-b2b.html">B2B</a></li>
        
        <li><a href="/guides/v2.2/howdoi/checkout/checkout_overview.html">Checkout</a></li>
        <li><a href="/guides/v2.2/payments-integrations/bk-payments-integrations.html">支付集成</a></li>
        
          <li><a href="/guides/v2.2/extension-dev-guide/staging.html">Staging</a></li>
        
      </ul>
    </div>

  </li>


  <li class="nav-main-item"  tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">指引</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.2/howdoi/bk-how-do-i.html">如何</a></li>
        
        <li><a  data-proofer-ignore href="/guides/v2.2/get-started/order-tutorial/order-intro.html">使用EST APIs处理订单</a></li>
        

        <li><a href="/videos/">视频教程</a></li>
      </ul>
    </div>

  </li>

</ul><!-- /.nav-main -->

    </div>

    <div class="search-btn">
      <a class="search-trigger search-icon" href="#"></a>
    </div>

    <form class="quick-search" action="/guides/v2.2/search.html" method="get" novalidate="novalidate">
      <input type="search" name="q" placeholder="Search" />
      <a href="#" class="quick-search-close">&times;</a>
    </form>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" data-proofer-ignore class="toc-toggler">内容表格</a>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">配置手册</h4>
		<div class="collapsible-navigation">
		    <ul>
		    
		    	

<li class="nav-level1  " id="介绍">
    

    
    <a href="/guides/v2.2/config-guide/bk-config-guide.html">介绍</a>
    

    
</li>


		    
		    	

<li class="nav-level1  " id="安全设置">
    

    
    <a href="/guides/v2.2/config-guide/secy/secy.html">安全设置</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="确保cron.php文件在浏览器上的安全">

            

            
            <a href="/guides/v2.2/config-guide/secy/secy-cron.html">确保cron.php文件在浏览器上的安全</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="x-frame-options头">

            

            
            <a href="/guides/v2.2/config-guide/secy/secy-xframe.html">X-Frame-Options头</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="防止缓存中毒">

            

            
            <a href="/guides/v2.2/config-guide/secy/secy-headers.html">防止缓存中毒</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="magento初始化和引导">
    

    
    <a href="/guides/v2.2/config-guide/bootstrap/magento-bootstrap.html">Magento初始化和引导</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="设置引导参数">

            

            
            <a href="/guides/v2.2/config-guide/bootstrap/magento-how-to-set.html">设置引导参数</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="关于magento的模式">

            

            
            <a href="/guides/v2.2/config-guide/bootstrap/magento-modes.html">关于Magento的模式</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="自定义基础目录路径(mage_dirs)">

            

            
            <a href="/guides/v2.2/config-guide/bootstrap/mage-dirs.html">自定义基础目录路径(MAGE_DIRS)</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="开启扼要记录(mage_profiler)">

            

            
            <a href="/guides/v2.2/config-guide/bootstrap/mage-profiler.html">开启扼要记录(MAGE_PROFILER)</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="管道部署">
    

    
    <a href="/guides/v2.2/config-guide/deployment/">管道部署</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="overview">

            

            
            <a href="/guides/v2.2/config-guide/deployment/pipeline/">Overview</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="技术细节">

            

            
            <a href="/guides/v2.2/config-guide/deployment/pipeline/technical-details.html">技术细节</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="开发系统设置">

            

            
            <a href="/guides/v2.2/config-guide/deployment/pipeline/development-system.html">开发系统设置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="构建系统设置">

            

            
            <a href="/guides/v2.2/config-guide/deployment/pipeline/build-system.html">构建系统设置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="生产系统设置">

            

            
            <a href="/guides/v2.2/config-guide/deployment/pipeline/production-system.html">生产系统设置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="文件系统访问权限">

            

            
            <a href="/guides/v2.2/config-guide/prod/prod_file-sys-perms.html">文件系统访问权限</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="examples">

            

            
            <span>Examples</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="共享配置">
                    

                    
                    <a  href="/guides/v2.2/config-guide/deployment/pipeline/example/shared-configuration.html">共享配置</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="使用命令行命令">
                    

                    
                    <a  href="/guides/v2.2/config-guide/deployment/pipeline/example/cli.html">使用命令行命令</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="使用环境变量">
                    

                    
                    <a  href="/guides/v2.2/config-guide/deployment/pipeline/example/environment-variables.html">使用环境变量</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="使用rsync同步命令">
                    

                    
                    <a  href="/guides/v2.2/config-guide/deployment/pipeline/example/rsync.html">使用rsync同步命令</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="单机部署">
    

    
    <a href="/guides/v2.2/config-guide/deployment/single-machine.html">单机部署</a>
    

    
</li>


		    
		    	

<li class="nav-level1  " id="命令行配置">
    

    
    <a href="/guides/v2.2/config-guide/cli/config-cli.html">命令行配置</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="命令行配置起步">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands.html">命令行配置起步</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="管理缓存">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-cache.html">管理缓存</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="管理索引">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-index.html">管理索引</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置和执行定时任务">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-cron.html">配置和执行定时任务</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="代码编译器">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-compiler.html">代码编译器</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="设置magento的模式">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-mode.html">设置Magento的模式</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="统一资源名称(urn)高亮">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-urn.html">统一资源名称(URN)高亮</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="依赖报告">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-depen.html">依赖报告</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置管理">

            

            
            <span>配置管理</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="导出配置">
                    

                    
                    <a  href="/guides/v2.2/config-guide/cli/config-cli-subcommands-config-mgmt-export.html">导出配置</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="设置配置值">
                    

                    
                    <a  href="/guides/v2.2/config-guide/cli/config-cli-subcommands-config-mgmt-set.html">设置配置值</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="从配置文件导入数据">
                    

                    
                    <a  href="/guides/v2.2/config-guide/cli/config-cli-subcommands-config-mgmt-import.html">从配置文件导入数据</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="翻译字典和语言包">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-i18n.html">翻译字典和语言包</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="静态视图文件部署">

            

            
            <span>静态视图文件部署</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="静态文件部署策略">
                    

                    
                    <a  href="/guides/v2.2/config-guide/cli/config-cli-subcommands-static-deploy-strategies.html">静态文件部署策略</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="部署静态视图文件">
                    

                    
                    <a  href="/guides/v2.2/config-guide/cli/config-cli-subcommands-static-view.html">部署静态视图文件</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="创建软链接到less文件">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-less-sass.html">创建软链接到LESS文件</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="运行单元测试">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-test.html">运行单元测试</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="转换布局的xml文件">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-layout-xml.html">转换布局的XML文件</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="为性能测试生成数据">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-perf-data.html">为性能测试生成数据</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="运行magento支持工具-(magento-commerce-only)">

            

            
            <a href="/guides/v2.2/config-guide/cli/config-cli-subcommands-spt-util.html">运行Magento支持工具 (仅企业版适用)</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="magento配置文件">
    

    
    <a href="/guides/v2.2/config-guide/config/config-magento.html">Magento配置文件</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="magento的部署配置">

            

            
            <a href="/guides/v2.2/config-guide/config/config-php.html">Magento的部署配置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="模块配置文件">

            

            
            <a href="/guides/v2.2/config-guide/config/config-files.html">模块配置文件</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="创建或扩展配置类型">

            

            
            <a href="/guides/v2.2/config-guide/config/config-create.html">创建或扩展配置类型</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="禁用模块输出">

            

            
            <a href="/guides/v2.2/config-guide/config/disable-module-output.html">禁用模块输出</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置参考">

            

            
            <span>配置参考</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="敏感的和系统特定的">
                    

                    
                    <a  href="/guides/v2.2/config-guide/prod/config-reference-sens.html">敏感的和系统特定的</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="支付配置路径参考">
                    

                    
                    <a  href="/guides/v2.2/config-guide/prod/config-reference-payment.html">支付配置路径参考</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="其它配置路径参考">
                    

                    
                    <a  href="/guides/v2.2/config-guide/prod/config-reference-most.html">其它配置路径参考</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="magento-commerce-for-b2b-extension-configuration-paths-reference">
                    

                    
                    <a  href="/guides/v2.2/config-guide/prod/config-reference-b2b.html">Magento Commerce for B2B Extension configuration paths reference</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id=".gitignore参考">
                    

                    
                    <a  href="/guides/v2.2/config-guide/prod/config-reference-gitignore.html">.gitignore参考</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="使用环境变量覆盖配置设置">
                    

                    
                    <a  href="/guides/v2.2/config-guide/prod/config-reference-var-name.html">使用环境变量覆盖配置设置</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="config.php参考">
                    

                    
                    <a  href="/guides/v2.2/config-guide/prod/config-reference-configphp.html">config.php参考</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="env.php参考">
                    

                    
                    <a  href="/guides/v2.2/config-guide/prod/config-reference-envphp.html">env.php参考</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="配置缓存">
    

    
    <a href="/guides/v2.2/config-guide/cache.html">配置缓存</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="将缓存前端与缓存类型关联">

            

            
            <a href="/guides/v2.2/config-guide/cache/cache-types.html">将缓存前端与缓存类型关联</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="底层缓存选项">

            

            
            <a href="/guides/v2.2/config-guide/cache/cache-options.html">底层缓存选项</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="静态内容签名">

            

            
            <a href="/guides/v2.2/config-guide/cache/static-content-signing.html">静态内容签名</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="配置redis">
    

    
    <a href="/guides/v2.2/config-guide/redis/config-redis.html">配置Redis</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="使用redis作为magento页面缓存和默认缓存">

            

            
            <a href="/guides/v2.2/config-guide/redis/redis-pg-cache.html">使用Redis作为Magento页面缓存和默认缓存</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="使用redis作为session存储">

            

            
            <a href="/guides/v2.2/config-guide/redis/redis-session.html">使用Redis作为Session存储</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="配置和使用varnish">
    

    
    <a href="/guides/v2.2/config-guide/varnish/config-varnish.html">配置和使用Varnish</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="安装varnish">

            

            
            <a href="/guides/v2.2/config-guide/varnish/config-varnish-install.html">安装Varnish</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置varnish和你的web服务器">

            

            
            <a href="/guides/v2.2/config-guide/varnish/config-varnish-configure.html">配置Varnish和你的web服务器</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置magento使用varnish">

            

            
            <a href="/guides/v2.2/config-guide/varnish/config-varnish-magento.html">配置Magento使用Varnish</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="varnish高级配置">

            

            
            <a href="/guides/v2.2/config-guide/varnish/config-varnish-advanced.html">Varnish高级配置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="how-magento-cache-clearing-works-with-multiple-varnish-instances">

            

            
            <a href="/guides/v2.2/config-guide/varnish/use-multiple-varnish-cache.html">How Magento cache clearing works with multiple Varnish instances</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="最终校验">

            

            
            <a href="/guides/v2.2/config-guide/varnish/config-varnish-final.html">最终校验</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="在varnish下magento的缓存清除是如何工作的">

            

            
            <a href="/guides/v2.2/config-guide/varnish/use-varnish-cache.html">在Varnish下Magento的缓存清除是如何工作的</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="varnish缓存是如何工作的">

            

            
            <a href="/guides/v2.2/config-guide/varnish/use-varnish-cache-how.html">Varnish缓存是如何工作的</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="排除503错误">

            

            
            <a href="/guides/v2.2/config-guide/varnish/tshoot-varnish-503.html">排除503错误</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="使用memcached做为session存储">
    

    
    <a href="/guides/v2.2/config-guide/memcache/memcache.html">使用memcached做为session存储</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="在ubuntu上安装、配置和验证memcached">

            

            
            <a href="/guides/v2.2/config-guide/memcache/memcache_ubuntu.html">在Ubuntu上安装、配置和验证memcached</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="在centos上安装、配置和验证memcached">

            

            
            <a href="/guides/v2.2/config-guide/memcache/memcache_centos.html">在CentOS上安装、配置和验证memcached</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置magento使用memcached">

            

            
            <a href="/guides/v2.2/config-guide/memcache/memcache_magento.html">配置Magento使用memcached</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="多站和多店">
    

    
    <a href="/guides/v2.2/config-guide/multi-site/ms_over.html">多站和多店</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="在管理面板设置多站、多店及网店视图">

            

            
            <a href="/guides/v2.2/config-guide/multi-site/ms_websites.html">在管理面板设置多站、多店及网店视图</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="教程-在nginx下设置多站或多店">

            

            
            <a href="/guides/v2.2/config-guide/multi-site/ms_nginx.html">教程-在nginx下设置多站或多店</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="教程-在apache下设置多站或多店">

            

            
            <a href="/guides/v2.2/config-guide/multi-site/ms_apache.html">教程-在Apache下设置多站或多店</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="设置自定义的定时任务和任务组(cron)">
    

    
    <a href="/guides/v2.2/config-guide/cron/custom-cron.html">设置自定义的定时任务和任务组(cron)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="自定义的定时任务和任务组(cron)参考">

            

            
            <a href="/guides/v2.2/config-guide/cron/custom-cron-ref.html">自定义的定时任务和任务组(cron)参考</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置自定义的定时任务和任务组(cron)(教程)">

            

            
            <a href="/guides/v2.2/config-guide/cron/custom-cron-tut.html">配置自定义的定时任务和任务组(cron)(教程)</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="配置数据库分析器">
    

    
    <a href="/guides/v2.2/config-guide/db-profiler/db-profiler.html">配置数据库分析器</a>
    

    
</li>


		    
		    	

<li class="nav-level1  " id="安装和配置elasticsearch-(magento-commerce-only)">
    

    
    <a href="/guides/v2.2/config-guide/elasticsearch/es-overview.html">安装和配置Elasticsearch (仅企业版适用)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="配置nginx和elasticsearch">

            

            
            <a href="/guides/v2.2/config-guide/elasticsearch/es-config-nginx.html">配置nginx和Elasticsearch</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置apache和elasticsearch">

            

            
            <a href="/guides/v2.2/config-guide/elasticsearch/es-config-apache.html">配置Apache和Elasticsearch</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置elasticsearch停用词">

            

            
            <a href="/guides/v2.2/config-guide/elasticsearch/es-config-stopwords.html">配置Elasticsearch停用词</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="配置magento使用elasticsearch">

            

            
            <a href="/guides/v2.2/config-guide/elasticsearch/configure-magento.html">配置Magento使用Elasticsearch</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="消息队列-(magento-commerce-only)">
    

    
    <a href="/guides/v2.2/config-guide/mq/rabbitmq-overview.html">消息队列 (仅企业版适用)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="管理消息队列">

            

            
            <a href="/guides/v2.2/config-guide/mq/manage-mysql.html">管理消息队列</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

		    
		    	

<li class="nav-level1  " id="数据库分库执行方案(仅企业版)">
    

    
    <a href="/guides/v2.2/config-guide/multi-master/multi-master.html">数据库分库执行方案(仅企业版)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="自动配置主数据库">

            

            
            <a href="/guides/v2.2/config-guide/multi-master/multi-master_masterdb.html">自动配置主数据库</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2 active " id="手动配置主数据库">

            

            
            <a href="/guides/v2.2/config-guide/multi-master/multi-master_manual.html">手动配置主数据库</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="数据库分库验证">

            

            
            <a href="/guides/v2.2/config-guide/multi-master/multi-master_verify.html">数据库分库验证</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="设置可选数据库复制">

            

            
            <a href="/guides/v2.2/config-guide/multi-master/multi-master_slavedb.html">设置可选数据库复制</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="自定义日志">
    

    
    <a href="/guides/v2.2/config-guide/log/log-intro.html">自定义日志</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="magento日志的更多细节">

            

            
            <a href="/guides/v2.2/config-guide/log/log-magento.html">Magento日志的更多细节</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="示例---记录数据库活动日志">

            

            
            <a href="/guides/v2.2/config-guide/log/log-db.html">示例 - 记录数据库活动日志</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="如何定位你的session文件">
    

    
    <a href="/guides/v2.2/config-guide/sessions.html">如何定位你的session文件</a>
    

    
</li>


		    
		    	

		    
		    	

		    
		    </ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

  <nav class="breadcrumbs">

    <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      <li class="breadcrumb-item"><a class="breadcrumb-item" href="/"><span>首页</span></a></li>

    <!-- Iteration breadcrumb item -->
    
    

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">

        
          <a property="item" typeof="WebPage" href="/guides/v2.2/config-guide/bk-config-guide.html">
            <span property="name">配置手册</span>
          </a>
        

        <meta property="position" content="1" />
      </li>

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item active" property="itemListElement" typeof="ListItem">

        

          

          <span property="name">手动配置主数据库</span>

        

        <meta property="position" content="2" />
      </li>

    

    </ol>

  </nav>



	
		<span class="ee-only">仅企业版适用</span>
	

	

	<h1 class="page-heading">手动配置主数据库</h1>

  


</section>

			<h2 id="config-ee-multidb-manual-over">Overview of manual split database configuration</h2>
<p>If the Magento application is already in production or if you’ve already installed custom code or components, you might need to configure split databases manually. Before continuing, contact Magento Support to see if this is necessary in your case.</p>

<p>Manually splitting databases involves:</p>

<ul>
  <li>Create the <span term-uuid="278c3ce0-cd4c-4ffc-a098-695d94d73bde" class="glossary-term" data-toggle="popover">checkout</span> and order management system (OMS) databases</li>
  <li>
    <p>Run a series of SQL scripts that:</p>

    <ul>
      <li>Drop foreign keys</li>
      <li>Back up sales and quote database tables</li>
      <li>Move tables from your main Magento database to the sales and quote databases</li>
    </ul>
  </li>
</ul>

<div class="bs-callout bs-callout-warning">
    <p>If any custom code uses JOINs with tables in the sales and quote databases, you <em>cannot</em> use split databases. If in doubt, contact the authors of any custom code or extensions to make sure their code does not use JOINs.</p>
</div>

<p>This topic uses the following naming conventions:</p>

<ul>
  <li>The main Magento database name is <code class="highlighter-rouge">magento</code> and its user name and password are both <code class="highlighter-rouge">magento</code></li>
  <li>
    <p>The quote database name is <code class="highlighter-rouge">magento_quote</code> and its user name and password are both <code class="highlighter-rouge">magento_quote</code></p>

    <p>The quote database is also referred to as the <em>checkout</em> database.</p>
  </li>
  <li>
    <p>The sales database name is <code class="highlighter-rouge">magento_sales</code> and its user name and password are both <code class="highlighter-rouge">magento_sales</code></p>

    <p>The sales database is also referred to as the order management system (<em>OMS</em>) database.</p>
  </li>
</ul>

<div class="bs-callout bs-callout-info" id="info">
<span class="glyphicon-class">
  <p>This guide assumes all three databases are on the same host as the Magento application. However, the choice of where to locate the databases and what they're named is up to you. We hope our examples make the instructions easier to follow.</p></span>
</div>

<h2 id="config-ee-multidb-backup">Back up the Magento system</h2>
<p>We strongly recommend you back up your current database and file system so you can restore it later in the <span term-uuid="c57aef7c-97b4-4b2b-a999-8001accef1fe" class="glossary-term" data-toggle="popover">event</span> of issues during the process.</p>

<div class="collapsible"><b class="collapsible-title">Click to show how to back up Magento </b><div class="collapsible-content"><p>To back up your system:</p>

<ol>
  <li>Log in to your Magento server as, or switch to, the <a href="/guides/v2.2/install-gde/prereq/apache-user.html">Magento文件系统所有者</a>.</li>
  <li>
    <p>Enter the following commands:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>magento setup:backup --code --media --db
</code></pre></div>    </div>
  </li>
  <li>Continue with the next section.</li>
</ol>
</div></div>

<h2 id="config-ee-multidb-master-masters">Set up additional master databases</h2>
<p>This section discusses how to create database instances for sales and <span term-uuid="77e19d0d-e7b1-4d3d-9bad-e92fbb9fb59a" class="glossary-term" data-toggle="popover">quote</span> tables.</p>

<div class="collapsible"><b class="collapsible-title">Click to show how to create database instances </b><div class="collapsible-content"><p>Create sales and OMS quote databases as follows:</p>

<ol>
  <li>Log in to your database server as any user.</li>
  <li>
    <p>Enter the following command to get to a MySQL command prompt:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p
</code></pre></div>    </div>
  </li>
  <li>Enter the MySQL <code class="highlighter-rouge">root</code> user’s password when prompted.</li>
  <li>
    <p>Enter the following commands in the order shown to create database instances named <code class="highlighter-rouge">magento_quote</code> and <code class="highlighter-rouge">magento_sales</code> with the same user names and passwords:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create database magento_quote;
GRANT ALL ON magento_quote.* TO magento_quote@localhost IDENTIFIED BY 'magento_quote';

create database magento_sales;
GRANT ALL ON magento_sales.* TO magento_sales@localhost IDENTIFIED BY 'magento_sales';
</code></pre></div>    </div>
  </li>
  <li>
    <p>Enter <code class="highlighter-rouge">exit</code> to quit the command prompt.</p>
  </li>
  <li>
    <p>Verify the databases, one at a time:</p>

    <p>quote database:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u magento_quote -p
exit
</code></pre></div>    </div>

    <p>Order management database:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u magento_sales -p
exit
</code></pre></div>    </div>

    <p>If the MySQL monitor displays, you created the database properly. If an error displays, repeat the preceding commands.</p>
  </li>
  <li>Continue with the next section.</li>
</ol>
</div></div>

<h2 id="config-ee-multidb-oms">Configure the sales database</h2>
<p>This section discusses how to create and run SQL scripts that alter quote database tables and back up data from those tables.</p>

<p>Sales database table names start with:</p>

<ul>
  <li><code class="highlighter-rouge">salesrule_</code></li>
  <li><code class="highlighter-rouge">sales_</code></li>
  <li><code class="highlighter-rouge">magento_sales_</code></li>
  <li>The <code class="highlighter-rouge">magento_customercustomattributes_sales_flat_order</code> table is also affected</li>
</ul>

<div class="bs-callout bs-callout-info" id="info">
  <p>This section contains scripts with specific database table names. If you've performed customizations or if you want to see a complete list of tables before you perform actions on them, see <a href="#split-db-ref">Reference scripts</a>.</p>
</div>

<p>For more information, see:</p>

<ul>
  <li><a href="#config-ee-multidb-sql-oms">Create sales database SQL scripts</a></li>
  <li><a href="#sales-backup">Back up sales data</a></li>
</ul>

<h3 id="config-ee-multidb-sql-oms">Create sales database SQL scripts</h3>

<div class="collapsible"><b class="collapsible-title">Click to create and run sales database SQL scripts </b><div class="collapsible-content"><p>Create the following SQL scripts in a location that is accessible by the user as whom you log in to your Magento server. For example, if you log in or run commands as <code class="highlighter-rouge">root</code>, you can create the scripts in the <code class="highlighter-rouge">/root/sql-scripts</code> directory.</p>

<h4 id="remove-foreign-keys">Remove foreign keys</h4>
<p>This script removes foreign keys that refer to non-sales tables from the sales database.</p>

<p>Create the following script and give it a name like <code class="highlighter-rouge">1_foreign-sales.sql</code>. Replace <code class="highlighter-rouge">&lt;your main Magento DB name&gt;</code> with the name of your Magento database.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">use</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">main</span> <span class="n">Magento</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_coupon_aggregated_order</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_COUPON_AGGREGATED_ORDER_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_coupon_aggregated</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_COUPON_AGGREGATED_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_coupon_aggregated_updated</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_COUPON_AGGREGATED_UPDATED_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_coupon_usage</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_COUPON_USAGE_CUSTOMER_ID_CUSTOMER_ENTITY_ENTITY_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_customer_group</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_CSTR_GROUP_CSTR_GROUP_ID_CSTR_GROUP_CSTR_GROUP_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_customer</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_CUSTOMER_CUSTOMER_ID_CUSTOMER_ENTITY_ENTITY_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_label</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_LABEL_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_product_attribute</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_PRD_ATTR_ATTR_ID_EAV_ATTR_ATTR_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_product_attribute</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_PRD_ATTR_CSTR_GROUP_ID_CSTR_GROUP_CSTR_GROUP_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_product_attribute</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_PRODUCT_ATTRIBUTE_WEBSITE_ID_STORE_WEBSITE_WEBSITE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">salesrule_website</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALESRULE_WEBSITE_WEBSITE_ID_STORE_WEBSITE_WEBSITE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_daily</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_BESTSELLERS_AGGRED_DAILY_PRD_ID_CAT_PRD_ENTT_ENTT_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_monthly</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_BESTSELLERS_AGGRED_MONTHLY_PRD_ID_CAT_PRD_ENTT_ENTT_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_yearly</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_BESTSELLERS_AGGRED_YEARLY_PRD_ID_CAT_PRD_ENTT_ENTT_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_daily</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_BESTSELLERS_AGGREGATED_DAILY_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_monthly</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_BESTSELLERS_AGGREGATED_MONTHLY_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_yearly</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_BESTSELLERS_AGGREGATED_YEARLY_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_creditmemo_grid</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_CREDITMEMO_GRID_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_creditmemo</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_CREDITMEMO_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_invoiced_aggregated_order</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_INVOICED_AGGREGATED_ORDER_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_invoiced_aggregated</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_INVOICED_AGGREGATED_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_invoice_grid</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_INVOICE_GRID_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_invoice</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_INVOICE_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_order_aggregated_created</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_ORDER_AGGREGATED_CREATED_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_order_aggregated_updated</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_ORDER_AGGREGATED_UPDATED_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_order</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_ORDER_CUSTOMER_ID_CUSTOMER_ENTITY_ENTITY_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_order_grid</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_ORDER_GRID_CUSTOMER_ID_CUSTOMER_ENTITY_ENTITY_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_order_grid</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_ORDER_GRID_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_order_item</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_ORDER_ITEM_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_order_status_label</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_ORDER_STATUS_LABEL_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_order</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_ORDER_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_refunded_aggregated_order</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_REFUNDED_AGGREGATED_ORDER_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_refunded_aggregated</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_REFUNDED_AGGREGATED_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_shipment_grid</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_SHIPMENT_GRID_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_shipment</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_SHIPMENT_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_shipping_aggregated_order</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_SHIPPING_AGGREGATED_ORDER_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">sales_shipping_aggregated</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">SALES_SHIPPING_AGGREGATED_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">magento_sales_creditmemo_grid_archive</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">MAGENTO_SALES_CREDITMEMO_GRID_ARCHIVE_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">magento_sales_invoice_grid_archive</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">MAGENTO_SALES_INVOICE_GRID_ARCHIVE_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">magento_sales_order_grid_archive</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">MAGENTO_SALES_ORDER_GRID_ARCHIVE_CSTR_ID_CSTR_ENTT_ENTT_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">magento_sales_order_grid_archive</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">MAGENTO_SALES_ORDER_GRID_ARCHIVE_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">magento_sales_shipment_grid_archive</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">MAGENTO_SALES_SHIPMENT_GRID_ARCHIVE_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">downloadable_link_purchased_item</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">DL_LNK_PURCHASED_ITEM_ORDER_ITEM_ID_SALES_ORDER_ITEM_ITEM_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">downloadable_link_purchased</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">DOWNLOADABLE_LINK_PURCHASED_ORDER_ID_SALES_ORDER_ENTITY_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">paypal_billing_agreement_order</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">PAYPAL_BILLING_AGREEMENT_ORDER_ORDER_ID_SALES_ORDER_ENTITY_ID</span><span class="p">;</span></code></pre></figure>

<h3 id="config-ee-multidb-sql-oms-run">Configure the sales database</h3>
<p>Run the preceding script:</p>

<ol>
  <li>
    <p>Log in to your MySQL database as the <code class="highlighter-rouge">root</code> or administrative user:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p
</code></pre></div>    </div>
  </li>
  <li>
    <p>At the <code class="highlighter-rouge">mysql&gt;</code> prompt, run the script as follows:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source &lt;path&gt;/&lt;script&gt;.sql
</code></pre></div>    </div>

    <p>For example,</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /root/sql-scripts/1_foreign-sales.sql
</code></pre></div>    </div>
  </li>
  <li>
    <p>After the script run, enter <code class="highlighter-rouge">exit</code>.</p>
  </li>
</ol>
</div></div>

<h3 id="sales-backup">Back up sales data</h3>
<p>This section discusses how to back up sales tables from the main Magento database so you can restore them in the separate sales database.</p>

<div class="collapsible"><b class="collapsible-title">Click to back up and restore sales data </b><div class="collapsible-content"><p>If you’re currently at the <code class="highlighter-rouge">mysql&gt;</code> prompt, enter <code class="highlighter-rouge">exit</code> to return to the command shell.</p>

<p>Run the following <code class="highlighter-rouge">mysqldump</code> commands, one at a time, from the command shell. In each, substitute the following:</p>

<ul>
  <li><code class="highlighter-rouge">&lt;your database root user name&gt;</code> with the name of your database root user</li>
  <li><code class="highlighter-rouge">&lt;your database root user password&gt;</code> with the user’s password</li>
  <li><code class="highlighter-rouge">&lt;your main magento DB name&gt;</code> with the name of your Magento database</li>
  <li><code class="highlighter-rouge">&lt;path&gt;</code> with a writable file system path</li>
</ul>

<p><strong>Script 1</strong></p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">mysqldump</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">your</span> <span class="k">database</span> <span class="n">root</span> <span class="k">user</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">main</span> <span class="n">magento</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span> <span class="n">sales_bestsellers_aggregated_daily</span> <span class="n">sales_bestsellers_aggregated_monthly</span> <span class="n">sales_bestsellers_aggregated_yearly</span> <span class="n">sales_creditmemo</span> <span class="n">sales_creditmemo_comment</span> <span class="n">sales_creditmemo_grid</span> <span class="n">sales_creditmemo_item</span> <span class="n">sales_invoice</span> <span class="n">sales_invoice_comment</span> <span class="n">sales_invoice_grid</span> <span class="n">sales_invoice_item</span> <span class="n">sales_invoiced_aggregated</span> <span class="n">sales_invoiced_aggregated_order</span> <span class="n">sales_order</span> <span class="n">sales_order_address</span> <span class="n">sales_order_aggregated_created</span> <span class="n">sales_order_aggregated_updated</span> <span class="n">sales_order_grid</span> <span class="n">sales_order_item</span> <span class="n">sales_order_payment</span> <span class="n">sales_order_status</span> <span class="n">sales_order_status_history</span> <span class="n">sales_order_status_label</span> <span class="n">sales_order_status_state</span> <span class="n">sales_order_tax</span> <span class="n">sales_order_tax_item</span> <span class="n">sales_payment_transaction</span> <span class="n">sales_refunded_aggregated</span> <span class="n">sales_refunded_aggregated_order</span> <span class="n">sales_sequence_meta</span> <span class="n">sales_sequence_profile</span> <span class="n">sales_shipment</span> <span class="n">sales_shipment_comment</span> <span class="n">sales_shipment_grid</span> <span class="n">sales_shipment_item</span> <span class="n">sales_shipment_track</span> <span class="n">sales_shipping_aggregated</span> <span class="n">sales_shipping_aggregated_order</span> <span class="o">&gt;</span> <span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">sales</span><span class="p">.</span><span class="k">sql</span></code></pre></figure>

<p><strong>Script 2</strong></p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">mysqldump</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">your</span> <span class="k">database</span> <span class="n">root</span> <span class="k">user</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">main</span> <span class="n">magento</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span> <span class="n">magento_sales_creditmemo_grid_archive</span> <span class="n">magento_sales_invoice_grid_archive</span> <span class="n">magento_sales_order_grid_archive</span> <span class="n">magento_sales_shipment_grid_archive</span> <span class="o">&gt;</span> <span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">salesarchive</span><span class="p">.</span><span class="k">sql</span></code></pre></figure>

<p><strong>Script 3</strong></p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">mysqldump</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">your</span> <span class="k">database</span> <span class="n">root</span> <span class="k">user</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">main</span> <span class="n">magento</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span> <span class="n">magento_customercustomattributes_sales_flat_order</span> <span class="n">magento_customercustomattributes_sales_flat_order_address</span> <span class="o">&gt;</span> <span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">customercustomattributes</span><span class="p">.</span><span class="k">sql</span></code></pre></figure>

<p><strong>Script 4</strong></p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">mysqldump</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">your</span> <span class="k">database</span> <span class="n">root</span> <span class="k">user</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">main</span> <span class="n">magento</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span> <span class="n">sequence_creditmemo_0</span> <span class="n">sequence_creditmemo_1</span> <span class="n">sequence_invoice_0</span> <span class="n">sequence_invoice_1</span> <span class="n">sequence_order_0</span> <span class="n">sequence_order_1</span> <span class="n">sequence_rma_item_0</span> <span class="n">sequence_rma_item_1</span> <span class="n">sequence_shipment_0</span> <span class="n">sequence_shipment_1</span> <span class="o">&gt;</span> <span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">sequence</span><span class="p">.</span><span class="k">sql</span></code></pre></figure>

<h3 id="sql-sales-restore">Restore sales data</h3>
<p>This script restores sales data in your quote database.</p>

<h4 id="ndb-requirement">NDB requirement</h4>
<p>If you are using a <a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-cluster.html" target="_blank">Network Database (NDB)</a> cluster:</p>

<ol>
  <li>
    <p>Convert tables from InnoDb to NDB type in dump files:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed -ei 's/InnoDb/NDB/' &lt;file name&gt;.sql
</code></pre></div>    </div>
  </li>
  <li>
    <p>Remove rows with a FULLTEXT key from dumps because NDB tables don’t support FULLTEXT.</p>
  </li>
</ol>

<h4 id="restore-the-data">Restore the data</h4>
<p>Run the following commands:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">root</span> <span class="k">user</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">sales</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span> <span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">sales</span><span class="p">.</span><span class="k">sql</span>
<span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">root</span> <span class="k">user</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">sales</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span> <span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">sequence</span><span class="p">.</span><span class="k">sql</span>
<span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">root</span> <span class="k">user</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">sales</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span> <span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">salesarchive</span><span class="p">.</span><span class="k">sql</span>
<span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="o">&lt;</span><span class="n">root</span> <span class="k">user</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">sales</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span> <span class="o">/&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">customercustomattributes</span><span class="p">.</span><span class="k">sql</span></code></pre></figure>

<p>where</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">&lt;your sales DB name&gt;</code> with the name of your sales database.</p>

    <p>In this topic, the sample database name is <code class="highlighter-rouge">magento_sales</code>.</p>
  </li>
  <li><code class="highlighter-rouge">&lt;root user name&gt;</code> with your MySQL root user name</li>
  <li><code class="highlighter-rouge">&lt;root user password&gt;</code> with the user’s password</li>
  <li>Verify the location of the backup files you created earlier (for example, <code class="highlighter-rouge">/var/sales.sql</code>)</li>
</ul>
</div></div>

<h2 id="config-ee-multidb-checkout">Configure the quote database</h2>
<p>This section discusses tasks required to drop foreign keys from sales database tables and move tables to the sales database.</p>

<div class="bs-callout bs-callout-info" id="info">
  <p>This section contains scripts with specific database table names. If you've performed customizations or if you want to see a complete list of tables before you perform actions on them, see <a href="#split-db-ref">Reference scripts</a>.</p>
</div>

<p>Quote database table names start with <code class="highlighter-rouge">quote</code>. The <code class="highlighter-rouge">magento_customercustomattributes_sales_flat_quote</code> and <code class="highlighter-rouge">magento_customercustomattributes_sales_flat_quote_address</code> tables are also affected</p>

<h3 id="drop-foreign-keys-from-quote-tables">Drop foreign keys from quote tables</h3>
<p>This script removes foreign keys that refer to non-quote tables from quote tables. Replace <your main="" magento="" DB="" name=""> with the name of your Magento database.</your></p>

<div class="collapsible"><b class="collapsible-title">Click to drop foreign keys from quote tables </b><div class="collapsible-content"><p>Create the following script and give it a name like <code class="highlighter-rouge">2_foreign-key-quote.sql</code>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">use</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">Magento</span> <span class="n">main</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">quote</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">QUOTE_STORE_ID_STORE_STORE_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">quote_item</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">QUOTE_ITEM_PRODUCT_ID_CATALOG_PRODUCT_ENTITY_ENTITY_ID</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">quote_item</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">QUOTE_ITEM_STORE_ID_STORE_STORE_ID</span><span class="p">;</span></code></pre></figure>

<p>Run the script as follows:</p>

<ol>
  <li>
    <p>Log in to your MySQL database as the root or administrative user:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p
</code></pre></div>    </div>
  </li>
  <li>
    <p>At the <code class="highlighter-rouge">mysql&gt;</code> prompt, run the script as follows:
it`.
    source <path>/<script>.sql
For example,</script></path></p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /root/sql-scripts/2_foreign-key-quote.sql
</code></pre></div>    </div>
  </li>
  <li>
    <p>After the script runs, enter <code class="highlighter-rouge">exit</code>.</p>
  </li>
</ol>
</div></div>

<h3 id="back-up-quote-tables">Back up quote tables</h3>
<p>This section discusses how to back up quote tables from the main Magento database and restore them in your quote database.</p>

<div class="collapsible"><b class="collapsible-title">Click to back up and restore quote tables </b><div class="collapsible-content"><p>Run the following command from a command prompt:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqldump -u &lt;your database root user name&gt; -p &lt;your main Magento DB name&gt; magento_customercustomattributes_sales_flat_quote magento_customercustomattributes_sales_flat_quote_address quote quote_address quote_address_item quote_item quote_item_option quote_payment quote_shipping_rate quote_id_mask &gt; /&lt;path&gt;/quote.sql;
</code></pre></div></div>

<h3 id="ndb-requirement">NDB requirement</h3>
<p>If you are using a <a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-cluster.html" target="_blank">Network Database (NDB)</a> cluster:</p>

<ol>
  <li>
    <p>Convert tables from InnoDb to NDB type in dump files:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed -ei 's/InnoDb/NDB/' &lt;file name&gt;.sql
</code></pre></div>    </div>
  </li>
  <li>
    <p>Remove rows with a FULLTEXT key from dumps because NDB tables don’t support FULLTEXT.</p>
  </li>
</ol>

<h3 id="restore-tables-to-the-quote-database">Restore tables to the quote database</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p magento_quote &lt; /&lt;path&gt;/quote.sql
</code></pre></div></div>
</div></div>

<h2 id="config-ee-multidb-drop">Drop sales and quote tables from the Magento database</h2>
<p>This script sales and quote tables from the Magento database. Replace <your main="" magento="" DB="" name=""> with the name of your Magento database.</your></p>

<div class="collapsible"><b class="collapsible-title">Click to drop sales and quote tables </b><div class="collapsible-content"><p>Create the following script and give it a name like <code class="highlighter-rouge">3_drop-tables.sql</code>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">use</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">Magento</span> <span class="n">main</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">SET</span> <span class="n">foreign_key_checks</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">magento_customercustomattributes_sales_flat_quote</span><span class="p">;</span> 
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">magento_customercustomattributes_sales_flat_quote_address</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">quote</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">quote_address</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">quote_address_item</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">quote_item</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">quote_item_option</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">quote_payment</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">quote_shipping_rate</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">quote_id_mask</span><span class="p">;</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_daily</span><span class="p">;</span>                        
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_monthly</span><span class="p">;</span>                      
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_bestsellers_aggregated_yearly</span><span class="p">;</span>                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_creditmemo</span><span class="p">;</span>                                          
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_creditmemo_comment</span><span class="p">;</span>                                  
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_creditmemo_grid</span><span class="p">;</span>                                     
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_creditmemo_item</span><span class="p">;</span>                                     
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_invoice</span><span class="p">;</span>                                             
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_invoice_comment</span><span class="p">;</span>                                     
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_invoice_grid</span><span class="p">;</span>                                        
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_invoice_item</span><span class="p">;</span>                                        
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_invoiced_aggregated</span><span class="p">;</span>                                 
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_invoiced_aggregated_order</span><span class="p">;</span>                           
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order</span><span class="p">;</span>                                               
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_address</span><span class="p">;</span>                                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_aggregated_created</span><span class="p">;</span>                            
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_aggregated_updated</span><span class="p">;</span>                            
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_grid</span><span class="p">;</span>                                          
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_item</span><span class="p">;</span>                                          
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_payment</span><span class="p">;</span>                                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_status</span><span class="p">;</span>                                        
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_status_history</span><span class="p">;</span>                                
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_status_label</span><span class="p">;</span>                                  
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_status_state</span><span class="p">;</span>                                  
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_tax</span><span class="p">;</span>                                           
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_order_tax_item</span><span class="p">;</span>                                      
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_payment_transaction</span><span class="p">;</span>                                 
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_refunded_aggregated</span><span class="p">;</span>                                 
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_refunded_aggregated_order</span><span class="p">;</span>                           
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_sequence_meta</span><span class="p">;</span>                                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_sequence_profile</span><span class="p">;</span>                                    
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_shipment</span><span class="p">;</span>                                            
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_shipment_comment</span><span class="p">;</span>                                    
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_shipment_grid</span><span class="p">;</span>                                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_shipment_item</span><span class="p">;</span>                                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_shipment_track</span><span class="p">;</span>                                      
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_shipping_aggregated</span><span class="p">;</span>                                 
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sales_shipping_aggregated_order</span><span class="p">;</span>                           
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">magento_sales_creditmemo_grid_archive</span><span class="p">;</span>                     
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">magento_sales_invoice_grid_archive</span><span class="p">;</span>                        
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">magento_sales_order_grid_archive</span><span class="p">;</span>                          
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">magento_sales_shipment_grid_archive</span><span class="p">;</span>                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">magento_customercustomattributes_sales_flat_order</span><span class="p">;</span>         
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">magento_customercustomattributes_sales_flat_order_address</span><span class="p">;</span> 
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_creditmemo_0</span><span class="p">;</span>                                     
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_creditmemo_1</span><span class="p">;</span>                                     
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_invoice_0</span><span class="p">;</span>                                        
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_invoice_1</span><span class="p">;</span>                                        
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_order_0</span><span class="p">;</span>                                          
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_order_1</span><span class="p">;</span>                                          
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_rma_item_0</span><span class="p">;</span>                                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_rma_item_1</span><span class="p">;</span>                                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_shipment_0</span><span class="p">;</span>                                       
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">sequence_shipment_1</span><span class="p">;</span>     
<span class="k">SET</span> <span class="n">foreign_key_checks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></code></pre></figure>

<p>Run the script as follows:</p>

<ol>
  <li>
    <p>Log in to your MySQL database as the root or administrative user:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u root -p
</code></pre></div>    </div>
  </li>
  <li>
    <p>At the <code class="highlighter-rouge">mysql&gt;</code> prompt, run the script as follows:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source &lt;path&gt;/&lt;script&gt;.sql
</code></pre></div>    </div>

    <p>For example,</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source /root/sql-scripts/3_drop-tables.sql
</code></pre></div>    </div>
  </li>
  <li>
    <p>After the script runs, enter <code class="highlighter-rouge">exit</code>.</p>
  </li>
</ol>
</div></div>

<h2 id="config-ee-multidb-config">Update your deployment configuration</h2>
<p>The final step in manually splitting databases is to add connection and resource information to Magento的部署配置, <code class="highlighter-rouge">env.php</code>.</p>

<div class="collapsible"><b class="collapsible-title">Click to update the Magento deployment configuration </b><div class="collapsible-content"><ol>
  <li>Log in to your Magento server as, or switch to, the <a href="/guides/v2.2/install-gde/prereq/file-sys-perms-over.html">Magento文件系统所有者</a>.</li>
  <li>
    <p>Back up your deployment configuration:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp &lt;your Magento install dir&gt;/app/etc/env.php &lt;your Magento install dir&gt;/app/etc/env.php.orig
</code></pre></div>    </div>
  </li>
  <li>Open <code class="highlighter-rouge">&lt;your Magento install dir&gt;/app/etc/env.php</code> in a text editor and update it using the guidelines discussed in the following sections.</li>
</ol>

<h3 id="update-database-connections">Update database connections</h3>

<p>Locate the block starting with <code class="highlighter-rouge">'default'</code> (under <code class="highlighter-rouge">'connection'</code>) and add <code class="highlighter-rouge">'checkout'</code> and <code class="highlighter-rouge">'sales'</code> sections. Replace sample values with values appropriate for your site.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"> <span class="s1">'default'</span> <span class="o">=&gt;</span> 
      <span class="k">array</span> <span class="p">(</span>
        <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
        <span class="s1">'dbname'</span> <span class="o">=&gt;</span> <span class="s1">'magento'</span><span class="p">,</span>
        <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'magento'</span><span class="p">,</span>
        <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'magento'</span><span class="p">,</span>
        <span class="s1">'model'</span> <span class="o">=&gt;</span> <span class="s1">'mysql4'</span><span class="p">,</span>
        <span class="s1">'engine'</span> <span class="o">=&gt;</span> <span class="s1">'innodb'</span><span class="p">,</span>
        <span class="s1">'initStatements'</span> <span class="o">=&gt;</span> <span class="s1">'SET NAMES utf8;'</span><span class="p">,</span>
        <span class="s1">'active'</span> <span class="o">=&gt;</span> <span class="s1">'1'</span><span class="p">,</span>
      <span class="p">),</span>
      <span class="s1">'checkout'</span> <span class="o">=&gt;</span> 
      <span class="k">array</span> <span class="p">(</span>
        <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
        <span class="s1">'dbname'</span> <span class="o">=&gt;</span> <span class="s1">'magento_quote'</span><span class="p">,</span>
        <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'magento_quote'</span><span class="p">,</span>
        <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'magento_quote'</span><span class="p">,</span>
        <span class="s1">'model'</span> <span class="o">=&gt;</span> <span class="s1">'mysql4'</span><span class="p">,</span>
        <span class="s1">'engine'</span> <span class="o">=&gt;</span> <span class="s1">'innodb'</span><span class="p">,</span>
        <span class="s1">'initStatements'</span> <span class="o">=&gt;</span> <span class="s1">'SET NAMES utf8;'</span><span class="p">,</span>
        <span class="s1">'active'</span> <span class="o">=&gt;</span> <span class="s1">'1'</span><span class="p">,</span>
      <span class="p">),</span>
      <span class="s1">'sales'</span> <span class="o">=&gt;</span> 
      <span class="k">array</span> <span class="p">(</span>
        <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
        <span class="s1">'dbname'</span> <span class="o">=&gt;</span> <span class="s1">'magento_sales'</span><span class="p">,</span>
        <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'magento_sales'</span><span class="p">,</span>
        <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'magento_sales'</span><span class="p">,</span>
        <span class="s1">'model'</span> <span class="o">=&gt;</span> <span class="s1">'mysql4'</span><span class="p">,</span>
        <span class="s1">'engine'</span> <span class="o">=&gt;</span> <span class="s1">'innodb'</span><span class="p">,</span>
        <span class="s1">'initStatements'</span> <span class="o">=&gt;</span> <span class="s1">'SET NAMES utf8;'</span><span class="p">,</span>
        <span class="s1">'active'</span> <span class="o">=&gt;</span> <span class="s1">'1'</span><span class="p">,</span>
      <span class="p">),</span>
    <span class="p">),</span></code></pre></figure>

<h3 id="update-resources">Update resources</h3>
<p>Locate the block starting with <code class="highlighter-rouge">'resource'</code> and add <code class="highlighter-rouge">'checkout'</code> and <code class="highlighter-rouge">'sales'</code> sections to it as follows:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="s1">'resource'</span> <span class="o">=&gt;</span> 
  <span class="k">array</span> <span class="p">(</span>
    <span class="s1">'default_setup'</span> <span class="o">=&gt;</span> 
    <span class="k">array</span> <span class="p">(</span>
      <span class="s1">'connection'</span> <span class="o">=&gt;</span> <span class="s1">'default'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'checkout'</span> <span class="o">=&gt;</span> 
    <span class="k">array</span> <span class="p">(</span>
      <span class="s1">'connection'</span> <span class="o">=&gt;</span> <span class="s1">'checkout'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s1">'sales'</span> <span class="o">=&gt;</span> 
    <span class="k">array</span> <span class="p">(</span>
      <span class="s1">'connection'</span> <span class="o">=&gt;</span> <span class="s1">'sales'</span><span class="p">,</span>
    <span class="p">),</span></code></pre></figure>
</div></div>

<h2 id="split-db-ref">Reference scripts</h2>
<p>This section provides scripts you can run that print a complete list of affected tables without performing any actions on them. You can use them to see what tables are affected before you manually split databases, which can be useful if you use extensions that customize the Magento <span term-uuid="66b924b4-8097-4aea-93d9-05a81e6cc00c" class="glossary-term" data-toggle="popover">数据库表结构</span>.</p>

<div class="collapsible"><b class="collapsible-title">Click to view reference SQL scripts </b><div class="collapsible-content"><p>To use these scripts:</p>

<ol>
  <li>Create a <code class="highlighter-rouge">.sql</code> script with the contents of each script in this section.</li>
  <li>
    <p>In each script, replace <code class="highlighter-rouge">&lt;your main magento DB name&gt;</code> with the name of your Magento database.</p>

    <p>In this topic, the sample database name is <code class="highlighter-rouge">magento</code>.</p>
  </li>
  <li>Run each script from the <code class="highlighter-rouge">mysql&gt;</code> prompt as <code class="highlighter-rouge">source &lt;script name&gt;</code></li>
  <li>Examine the output.</li>
  <li>Copy the result of each script to another <code class="highlighter-rouge">.sql</code> script, removing the pipe characters (<code class="highlighter-rouge">|</code>).</li>
  <li>
    <p>Run each script from the <code class="highlighter-rouge">mysql&gt;</code> prompt as <code class="highlighter-rouge">source &lt;script name&gt;</code>.</p>

    <p>Running this second script performs the actions in your main Magento database.</p>
  </li>
</ol>

<h3 id="remove-foreign-keys-sales-tables">Remove foreign keys (sales tables)</h3>
<p>This script is the removes foreign keys that refer to non-sales tables from the sales database.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">select</span> <span class="n">concat</span><span class="p">(</span>
    <span class="s1">'ALTER TABLE '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">for_name</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">' DROP FOREIGN KEY '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">';'</span>
    <span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">INNODB_SYS_FOREIGN</span>
<span class="k">where</span> <span class="n">for_name</span> <span class="k">like</span>  <span class="s1">'&lt;your main magento DB name&gt;/|sales_%'</span> <span class="k">escape</span> <span class="s1">'|'</span>
    <span class="k">and</span> <span class="n">ref_name</span> <span class="k">not</span> <span class="k">like</span>  <span class="s1">'&lt;your main magento DB name&gt;/|sales_%'</span> <span class="k">escape</span> <span class="s1">'|'</span>
<span class="k">union</span> <span class="k">all</span>
<span class="k">select</span> <span class="n">concat</span><span class="p">(</span>
    <span class="s1">'ALTER TABLE '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">for_name</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">' DROP FOREIGN KEY '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">';'</span>
    <span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">INNODB_SYS_FOREIGN</span>
<span class="k">where</span> <span class="n">for_name</span> <span class="k">like</span>  <span class="s1">'&lt;your main magento DB name&gt;/|magento_sales|_%'</span> <span class="k">escape</span> <span class="s1">'|'</span>
    <span class="k">and</span> <span class="n">ref_name</span> <span class="k">not</span> <span class="k">like</span>  <span class="s1">'&lt;your main magento DB name&gt;/|sales|_%'</span> <span class="k">escape</span> <span class="s1">'|'</span>
<span class="p">;</span></code></pre></figure>

<h3 id="remove-foreign-keys-quote-tables">Remove foreign keys (quote tables)</h3>
<p>This script removes foreign keys that refer to non-quote tables from quote tables.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">select</span> <span class="n">concat</span><span class="p">(</span>
    <span class="s1">'ALTER TABLE '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">for_name</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">' DROP FOREIGN KEY '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">';'</span>
    <span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">INNODB_SYS_FOREIGN</span>
<span class="k">where</span> <span class="n">for_name</span> <span class="k">like</span> <span class="s1">'&lt;your main magento DB name&gt;/%'</span>
    <span class="k">and</span> <span class="n">ref_name</span> <span class="k">like</span> <span class="s1">'&lt;your main magento DB name&gt;/sales</span><span class="se">\_</span><span class="s1">%'</span>
<span class="k">union</span> <span class="k">all</span>
<span class="k">select</span> <span class="n">concat</span><span class="p">(</span>
    <span class="s1">'ALTER TABLE '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">for_name</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">' DROP FOREIGN KEY '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">';'</span>
    <span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">INNODB_SYS_FOREIGN</span>
<span class="k">where</span> <span class="n">for_name</span> <span class="k">like</span> <span class="s1">'&lt;your main magento DB name&gt;/%'</span>
    <span class="k">and</span> <span class="n">ref_name</span> <span class="k">like</span> <span class="s1">'&lt;your main magento DB name&gt;/magento_sales</span><span class="se">\_</span><span class="s1">%'</span>
<span class="k">union</span> <span class="k">all</span>
<span class="k">select</span> <span class="n">concat</span><span class="p">(</span>
    <span class="s1">'ALTER TABLE '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">for_name</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">' DROP FOREIGN KEY '</span><span class="p">,</span>
    <span class="k">replace</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s1">'&lt;your main magento DB name&gt;/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span>
    <span class="s1">';'</span>
    <span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">INNODB_SYS_FOREIGN</span>
<span class="k">where</span> <span class="n">for_name</span> <span class="k">like</span> <span class="s1">'&lt;your main magento DB name&gt;/%'</span>
    <span class="k">and</span> <span class="n">ref_name</span> <span class="k">like</span> <span class="s1">'&lt;your main magento DB name&gt;/magento_customercustomattributes</span><span class="se">\_</span><span class="s1">%'</span>
<span class="p">;</span></code></pre></figure>

<h3 id="drop-sales-tables">Drop sales tables</h3>
<p>This script drops sales tables from the Magento database.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">use</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">main</span> <span class="n">magento</span> <span class="n">DB</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">select</span> <span class="s1">' SET foreign_key_checks = 0;'</span> <span class="k">as</span> <span class="n">querytext</span>
<span class="k">union</span> <span class="k">all</span>
<span class="k">select</span>
    <span class="n">concat</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS '</span> <span class="p">,</span> <span class="k">table_name</span><span class="p">,</span> <span class="s1">';'</span><span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span>
<span class="k">where</span> <span class="n">table_schema</span> <span class="o">=</span> <span class="s1">'&lt;your main magento DB name&gt;'</span>
<span class="k">and</span> <span class="k">table_name</span> <span class="k">like</span> <span class="s1">'sales/_%'</span> <span class="k">escape</span> <span class="s1">'/'</span>
<span class="k">union</span> <span class="k">all</span>
<span class="k">select</span>
    <span class="n">concat</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS '</span> <span class="p">,</span> <span class="k">table_name</span><span class="p">,</span> <span class="s1">';'</span><span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span>
<span class="k">where</span> <span class="n">table_schema</span> <span class="o">=</span> <span class="s1">'&lt;your main magento DB name&gt;'</span>
<span class="k">and</span> <span class="k">table_name</span> <span class="k">like</span> <span class="s1">'magento_sales/_%'</span> <span class="k">escape</span> <span class="s1">'/'</span>
<span class="k">union</span> <span class="k">all</span>
<span class="k">select</span>
    <span class="n">concat</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS '</span> <span class="p">,</span> <span class="k">table_name</span><span class="p">,</span> <span class="s1">';'</span><span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span>
<span class="k">where</span> <span class="n">table_schema</span> <span class="o">=</span> <span class="s1">'&lt;your main magento DB name&gt;'</span>
<span class="k">and</span> <span class="k">table_name</span> <span class="k">like</span> <span class="s1">'magento_customercustomattributes_sales_flat_order%'</span> <span class="k">escape</span> <span class="s1">'/'</span>
<span class="k">union</span> <span class="k">all</span>
<span class="k">select</span>
    <span class="n">concat</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS '</span> <span class="p">,</span> <span class="k">table_name</span><span class="p">,</span> <span class="s1">';'</span><span class="p">)</span>
<span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span>
<span class="k">where</span> <span class="n">table_schema</span> <span class="o">=</span> <span class="s1">'&lt;your main magento DB name&gt;'</span>
<span class="k">and</span> <span class="k">table_name</span> <span class="k">like</span> <span class="s1">'sequence/_%'</span> <span class="k">escape</span> <span class="s1">'/'</span>
<span class="k">union</span> <span class="k">all</span>
<span class="k">select</span> <span class="s1">'SET foreign_key_checks = 1;'</span><span class="p">;</span></code></pre></figure>

<h3 id="drop-quote-tables">Drop quote tables</h3>
<p>Drop all tables that start with <code class="highlighter-rouge">quote_</code>.</p>
</div></div>

<h4 id="下一步">下一步</h4>
<p><a href="/guides/v2.2/config-guide/multi-master/multi-master_verify.html">数据库分库验证</a></p>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

    
  
    
    <div class="github-link">
      <a class="improve-page" href="https://github.com/magento/devdocs/blob/develop/guides/v2.2/config-guide/multi-master/multi-master_manual.md" target="_blank">
        去GitHub上编辑
      </a>
    </div>
    
  
    
    <div class="new-issue">
      <a href="https://github.com/magento/devdocs/issues/new?title=Feedback on page: /guides/v2.2/config-guide/multi-master/multi-master_manual.html" target="_blank">反馈</a>
    </div>
    
  
  </div>

	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav footer-links">
  <li><a href="/guides/v2.2/contributor-guide/contributing_docs.html">成为贡献者</a>
  <li><a href="https://magento.github.io/glossary/index.html?audience=developer">术语表</a></li>
  <li><a href="http://magento.com/legal/terms/privacy/">隐私政策</a></li>
  <li><a href="http://magento.com/legal/terms/">服务条款</a></li>
  <li><a href="http://magento.com/legal/licensing/">许可/商标 常见问题</a></li>
  <li><a href="/guides/v2.2/release-notes/bk-release-notes.html">版本日志</a></li>
  <li><a href="/magento-third-party.html">三方许可</a></li>
</ul>

    </div>

		<div class="copyright-date">&copy; 2018 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/assets/js/app.min.js"></script>


<script src="/common/js/devdocs.min.js"></script>




</body>
</html>

