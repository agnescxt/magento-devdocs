<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>部署代码并迁移静态文件和数据 | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">

	<link rel="stylesheet" href="/assets/css/app.css" />
	<link rel="stylesheet" href="/assets/css/print.css" media="print"/>

	<link rel="stylesheet" href="/common/css/devdocs.css" />

	<script>
  var baseUrl = "";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c"
  };
</script>




	<link rel="canonical" href="/guides/v2.1/cloud/live/stage-prod-migrate.html">

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">

	<header class="site-header">

		<nav class="site-nav">

  <div class="menu-btn">
    <a id="menu-btn" class="menu-trigger menu-icon" href="#nav-main" aria-haspopup="true" aria-controls="nav-main"></a>
  </div>

  <div class="nav-container">

    <a class="logo" href="/guides/v2.1/">
      <img src="/assets/i/m-logo.svg" alt=""><img src="/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      
<div class="version-switcher dropdown" data-version="2.1">
	<button id="version-switcher-button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Magento 2.1
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.0/cloud/live/stage-prod-migrate.html">Magento 2.0</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.1/cloud/live/stage-prod-migrate.html">Magento 2.1</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.2/cloud/live/stage-prod-migrate.html">Magento 2.2</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.3/cloud/live/stage-prod-migrate.html">Magento 2.3 Pre-release</a></li>
	
  </ul>

</div>


      <!-- Main Navigation -->
<ul class="nav-main" role="menubar">

  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">部署</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          <li><a href="/guides/v2.1/install-gde/bk-install-guide.html">安装向导</a></li>
          
          <li><a href="/guides/v2.1/comp-mgr/bk-compman-upgrade-guide.html">组件管理和系统升级手册</a></li>
          
          <li><a href="/guides/v2.1/config-guide/bk-config-guide.html">配置手册</a></li>
          
          <li><a href="/guides/v2.1/migration/bk-migration-guide.html">迁移指引</a></li>
          <li><a href="/guides/v2.1/cloud/bk-cloud.html">上云指引</a></li>
          <li><a href="/magento-release-information.html">版本日志</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">开发</span>

    <div class="nav-popup" role="menu" aria-hidden="true">

      <div class="nav-section">
        <div class="nav-section-title">服务端</div>
        <ul>
          <li><a href="/guides/v2.1/architecture/bk-architecture.html">架构说明</a></li>
          <li><a href="/guides/v2.1/extension-dev-guide/bk-extension-dev-guide.html">PHP开发文档</a></li>
          <li><a href="/guides/v2.1/ext-best-practices/bk-ext-best-practices.html">扩展开发实践</a></li>
          <li><a href="/guides/v2.1/mrg/intro.html">各模块介绍</a></li>
          <li><a href="/guides/v2.1/coding-standards/bk-coding-standards.html">编码规范</a></li>
          <li><a href="/guides/v2.1/contributor-guide/contributing.html">贡献指引</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">前端</div>
        <ul>
          <li class=""><a href="/guides/v2.1/frontend-dev-guide/bk-frontend-dev-guide.html">前端工程师手册</a></li>
          
          <li><a href="/guides/v2.1/ui_comp_guide/bk-ui_comps.html">UI组件手册</a></li>
          
          <li><a href="/guides/v2.1/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript开发手册</a></li>
          <li><a href="/guides/v2.1/pattern-library/bk-pattern.html">管理面板设计模式及所用库</a></li>
          <li><a href="/guides/v2.1/design-styleguide/bk-styleguide.html">管理面板样式手册</a></li>
          <li><a href="https://magento-research.github.io/pwa-devdocs/">PWA Studios</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title"><abbr>API</abbr></div>
        <ul>
          <li><a href="/guides/v2.1/get-started/bk-get-started-api.html">Web APIs起步</a></li>
          <li><a href="/guides/v2.1/rest/bk-rest.html">REST API参考</a></li>
          <li><a href="/guides/v2.1/soap/bk-soap.html">SOAP API参考</a></li>
          
          
          <li><a href="/guides/v2.1/marketplace/eqp/api.html">Marketplace EQP API Reference</a></li>
          
        </ul>
      </div>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">测试</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.1/test/testing.html">Magento测试手册</a></li>
        
        <li><a href="/guides/v2.1/mtf/mtf_introduction.html">功能测试</a></li>
        <li><a href="/guides/v2.1/test/integration/integration_test_execution.html">集成测试</a></li>
        <li><a href="/guides/v2.1/test/js/jasmine.html">JavaScript单元测试</a></li>
        <li><a href="/guides/v2.1/test/unit/unit_test_execution.html">PHP单元测试</a></li>
        <li><a href="/guides/v2.1/get-started/web-api-functional-testing.html">Web API功能测试</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-separator"></li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">功能文档</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          
        
        <li><a href="/guides/v2.1/howdoi/checkout/checkout_overview.html">Checkout</a></li>
        <li><a href="/guides/v2.1/payments-integrations/bk-payments-integrations.html">支付集成</a></li>
        
          <li><a href="/guides/v2.1/extension-dev-guide/staging.html">Staging</a></li>
        
      </ul>
    </div>

  </li>


  <li class="nav-main-item"  tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">指引</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.1/howdoi/bk-how-do-i.html">如何</a></li>
        
        <li><a  data-proofer-ignore href="/guides/v2.1/get-started/order-tutorial/order-intro.html">使用EST APIs处理订单</a></li>
        

        <li><a href="/videos/">视频教程</a></li>
      </ul>
    </div>

  </li>

</ul><!-- /.nav-main -->

    </div>

    <div class="search-btn">
      <a class="search-trigger search-icon" href="#"></a>
    </div>

    <form class="quick-search" action="/guides/v2.1/search.html" method="get" novalidate="novalidate">
      <input type="search" name="q" placeholder="Search" />
      <a href="#" class="quick-search-close">&times;</a>
    </form>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" data-proofer-ignore class="toc-toggler">内容表格</a>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title"></h4>
		<div class="collapsible-navigation">
		    <ul>
		    
		    	

<li class="nav-level1  " id="欢迎使用magento企业版(云支持版)">
    

    
    <a href="/guides/v2.1/cloud/bk-cloud.html">欢迎使用Magento企业版(云支持版)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="订阅和计划">

            

            
            <a href="/guides/v2.1/cloud/basic-information/cloud-plans.html">订阅和计划</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="新手上路任务">

            

            
            <a href="/guides/v2.1/cloud/onboarding/onboarding-tasks.html">新手上路任务</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="architecture">
    

    
    <a href="/guides/v2.1/cloud/architecture/cloud-architecture.html">Architecture</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="架构起步">

            

            
            <a href="/guides/v2.1/cloud/basic-information/starter-architecture.html">架构起步</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="开发和部署工作流起步">

            

            
            <a href="/guides/v2.1/cloud/basic-information/starter-develop-deploy-workflow.html">开发和部署工作流起步</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="pro-architecture">

            

            
            <a href="/guides/v2.1/cloud/architecture/pro-architecture.html">Pro architecture</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="pro-develop-and-deploy-workflow">

            

            
            <a href="/guides/v2.1/cloud/architecture/pro-develop-deploy-workflow.html">Pro develop and deploy workflow</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="pro-architecture-(legacy)">

            

            
            <a href="/guides/v2.1/cloud/architecture/pro-architecture-legacy.html">Pro architecture (legacy)</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="add-staging-and-production-to-pro-projects-ui">

            

            
            <a href="/guides/v2.1/cloud/trouble/pro-env-management.html">Add Staging and Production to Pro projects UI</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="技术和要求">
    

    
    <a href="/guides/v2.1/cloud/requirements/cloud-requirements.html">技术和要求</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="composer">

            

            
            <a href="/guides/v2.1/cloud/reference/cloud-composer.html">Composer</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="magento-cloud-cli">

            

            
            <a href="/guides/v2.1/cloud/reference/cli-ref-topic.html">Magento Cloud CLI</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="git">

            

            
            <a href="/guides/v2.1/cloud/reference/git-integration.html">Git</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="bitbucket集成">

            

            
            <a href="/guides/v2.1/cloud/project/bitbucket-integration.html">Bitbucket集成</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="github集成">

            

            
            <a href="/guides/v2.1/cloud/project/project-integrate-github.html">Github集成</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="ssh和sftp">

            

            
            <a href="/guides/v2.1/cloud/env/environments-ssh.html">SSH和sFTP</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="new-relic-apm">

            

            
            <a href="/guides/v2.1/cloud/project/new-relic.html">New Relic APM</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="blackfire.io">

            

            
            <a href="/guides/v2.1/cloud/project/project-integrate-blackfire.html">Blackfire.io</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="sendgrid">

            

            
            <a href="/guides/v2.1/cloud/project/sendgrid.html">SendGrid</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="本地环境设置">
    

    
    <a href="/guides/v2.1/cloud/access-acct/first-time-setup.html">本地环境设置</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="本地环境设置准备">

            

            
            <a href="/guides/v2.1/cloud/before/before-workspace.html">本地环境设置准备</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="安装magento所需的必要软件">

            

            
            <a href="/guides/v2.1/cloud/before/before-workspace-magento-prereqs.html">安装Magento所需的必要软件</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="启用ssh密钥登录">

            

            
            <a href="/guides/v2.1/cloud/before/before-workspace-ssh.html">启用ssh密钥登录</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="设置magento文件系统所有者">

            

            
            <a href="/guides/v2.1/cloud/before/before-workspace-file-sys-owner.html">设置Magento文件系统所有者</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="克隆并开发项目分支">

            

            
            <a href="/guides/v2.1/cloud/before/before-setup-env-2_clone.html">克隆并开发项目分支</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="安装magento">

            

            
            <a href="/guides/v2.1/cloud/before/before-setup-env-install.html">安装Magento</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="首次部署">

            

            
            <a href="/guides/v2.1/cloud/access-acct/first-time-deploy.html">首次部署</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="可选---安装样本数据">

            

            
            <a href="/guides/v2.1/cloud/howtos/sample-data.html">可选 - 安装样本数据</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="可选---配置xdebug">

            

            
            <a href="/guides/v2.1/cloud/howtos/debug.html">可选 - 配置Xdebug</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="导入现存的代码到项目">
    

    
    <a href="/guides/v2.1/cloud/access-acct/first-time-setup_import-first-steps.html">导入现存的代码到项目</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="prepare-your-existing-magento-commerce-system">

            

            
            <a href="/guides/v2.1/cloud/access-acct/first-time-setup_import-prepare.html">Prepare your existing Magento Commerce system</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="import-magento-commerce-into-magento企业版(云支持版)">

            

            
            <a href="/guides/v2.1/cloud/access-acct/first-time-setup_import-import.html">Import Magento Commerce into Magento企业版(云支持版)</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="配置你的网店">
    

    
    <a href="/guides/v2.1/cloud/configure/configuration-overview.html">配置你的网店</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="网店配置最佳实践">

            

            
            <a href="/guides/v2.1/cloud/configure/configure-best-practices.html">网店配置最佳实践</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="set-up-paypal">

            

            
            <a href="/guides/v2.1/cloud/live/paypal-onboarding.html">Set up PayPal</a>
            

            
        </li>
        
        
        
        
        
        
        <li class="nav-level2  " id="设置定时任务">

            

            
            <a href="/guides/v2.1/cloud/configure/setup-cron-jobs.html">设置定时任务</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="set-up-multiple-cloud-websites-or-stores">

            

            
            <a href="/guides/v2.1/cloud/project/project-multi-sites.html">Set up multiple Cloud websites or stores</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="安装，管理及升级模块">

            

            
            <a href="/guides/v2.1/cloud/howtos/install-components.html">安装，管理及升级模块</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="安装一个主题">

            

            
            <a href="/guides/v2.1/cloud/howtos/custom-theme.html">安装一个主题</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="快速配置">
    

    
    <a href="/guides/v2.1/cloud/basic-information/cloud-fastly.html">快速配置</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="快速设置">

            

            
            <a href="/guides/v2.1/cloud/access-acct/fastly.html">快速设置</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="快速定制vcl片段">

            

            
            <a href="/guides/v2.1/cloud/configure/cloud-vcl-custom-snippets.html">快速定制VCL片段</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="定制vcl白名单">

            

            
            <a href="/guides/v2.1/cloud/configure/fastly-vcl-whitelist.html">定制VCL白名单</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="定制vcl黑名单">

            

            
            <a href="/guides/v2.1/cloud/configure/fastly-vcl-blacklist.html">定制VCL黑名单</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vcl自定义延长管理员超时">

            

            
            <a href="/guides/v2.1/cloud/configure/fastly-vcl-extend-timeout.html">VCL自定义延长管理员超时</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vcl自定义自重向到wordpress">

            

            
            <a href="/guides/v2.1/cloud/configure/fastly-vcl-wordpress.html">VCL自定义自重向到WordPress</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vcl自定义块坏引用">

            

            
            <a href="/guides/v2.1/cloud/configure/fastly-vcl-badreferer.html">VCL自定义块坏引用</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="快速故障排查">

            

            
            <a href="/guides/v2.1/cloud/trouble/trouble_fastly.html">快速故障排查</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="配置环境">
    

    
    <a href="/guides/v2.1/cloud/env/environments.html">配置环境</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="application">

            

            
            <a href="/guides/v2.1/cloud/project/project-conf-files_magento-app.html">Application</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="构建和部署">

            

            
            <a href="/guides/v2.1/cloud/project/magento-env-yaml.html">构建和部署</a>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="设置通知">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/setup-notifications.html">设置通知</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="日志处理">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/log-handlers.html">日志处理</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="小向导">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/smart-wizards.html">小向导</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="环境变量">

            

            
            <a href="/guides/v2.1/cloud/env/variables-intro.html">环境变量</a>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="应用程序变量">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/environment-vars_magento.html">应用程序变量</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="构建变量">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/variables-build.html">构建变量</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="云变量">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/variables-cloud.html">云变量</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="deploy-variables">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/variables-deploy.html">Deploy variables</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="部署后变量">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/variables-post-deploy.html">部署后变量</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="在变量下工作">
                    

                    
                    <a  href="/guides/v2.1/cloud/env/working-with-variables.html">在变量下工作</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="routes">

            

            
            <a href="/guides/v2.1/cloud/project/project-conf-files_routes.html">Routes</a>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="caching">
                    

                    
                    <a  href="/guides/v2.1/cloud/project/project-routes-more-cache.html">Caching</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="redirects">
                    

                    
                    <a  href="/guides/v2.1/cloud/project/project-routes-more-redir.html">Redirects</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="服务端引入">
                    

                    
                    <a  href="/guides/v2.1/cloud/project/project-routes-more-ssi.html">服务端引入</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="services">

            

            
            <a href="/guides/v2.1/cloud/project/project-conf-files_services.html">Services</a>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="设置mysql服务">
                    

                    
                    <a  href="/guides/v2.1/cloud/project/project-conf-files_services-mysql.html">设置MySQL服务</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="设置redis服务">
                    

                    
                    <a  href="/guides/v2.1/cloud/project/project-conf-files_services-redis.html">设置Redis服务</a>
                    

                    
                </li>
                
                

                
                

                
                
                <li class="nav-level3  " id="设置elasticsearch服务">
                    

                    
                    <a  href="/guides/v2.1/cloud/project/project-conf-files_services-elastic.html">设置Elasticsearch服务</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="设置rabbitmq服务">
                    

                    
                    <a  href="/guides/v2.1/cloud/project/project-conf-files_services-rabbit.html">设置RabbitMQ服务</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="网店设置的配置管理">
    

    
    <a href="/guides/v2.1/cloud/live/sens-data-over.html">网店设置的配置管理</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="管理系统特定配置的示例">

            

            
            <a href="/guides/v2.1/cloud/live/sens-data-initial.html">管理系统特定配置的示例</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="管理你的项目">
    

    
    <a href="/guides/v2.1/cloud/project/projects.html">管理你的项目</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="配置你的项目">

            

            
            <a href="/guides/v2.1/cloud/project/project-webint-basic.html">配置你的项目</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="项目结构">

            

            
            <a href="/guides/v2.1/cloud/project/project-start.html">项目结构</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="创建和管理用户">

            

            
            <a href="/guides/v2.1/cloud/project/user-admin.html">创建和管理用户</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="manage-branches-with-the-interface">

            

            
            <a href="/guides/v2.1/cloud/project/project-webint-branch.html">Manage branches with the Interface</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="使用命令行管理分支">

            

            
            <a href="/guides/v2.1/cloud/env/environments-start.html">使用命令行管理分支</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="快照和备份管理">

            

            
            <a href="/guides/v2.1/cloud/project/project-webint-snap.html">快照和备份管理</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="部署你的网店">
    

    
    <a href="/guides/v2.1/cloud/live/stage-prod-live.html">部署你的网店</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="部署过程">

            

            
            <a href="/guides/v2.1/cloud/reference/discover-deploy.html">部署过程</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="continuous-deployment">

            

            
            <a href="/guides/v2.1/cloud/deploy/continuous-deployment.html">Continuous deployment</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="保护块">

            

            
            <a href="/guides/v2.1/cloud/live/live-prot.html">保护块</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="在本地构建和部署">

            

            
            <a href="/guides/v2.1/cloud/live/live-sanity-check.html">在本地构建和部署</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="准备部署准生产和生产环境">

            

            
            <a href="/guides/v2.1/cloud/live/stage-prod-migrate-prereq.html">准备部署准生产和生产环境</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2 active " id="部署代码并迁移静态文件和数据">

            

            
            <a href="/guides/v2.1/cloud/live/stage-prod-migrate.html">部署代码并迁移静态文件和数据</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="测试部署">

            

            
            <a href="/guides/v2.1/cloud/live/stage-prod-test.html">测试部署</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="上线和发布">
    

    
    <a href="/guides/v2.1/cloud/live/live.html">上线和发布</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="上线检查">

            

            
            <a href="/guides/v2.1/cloud/live/go-live-checklist.html">上线检查</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="发布步骤">

            

            
            <a href="/guides/v2.1/cloud/live/launch-steps.html">发布步骤</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="故障排除">
    

    
    <a href="/guides/v2.1/cloud/trouble/trouble.html">故障排除</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="部署故障排查">

            

            
            <a href="/guides/v2.1/cloud/access-acct/trouble.html">部署故障排查</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="查看日志排查故障">

            

            
            <a href="/guides/v2.1/cloud/trouble/environments-logs.html">查看日志排查故障</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="证书不正确">

            

            
            <a href="/guides/v2.1/cloud/trouble/trouble_ce-creds.html">证书不正确</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="新项目的问题解决">

            

            
            <a href="/guides/v2.1/cloud/trouble/trouble_proj-startover.html">新项目的问题解决</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="组件部署失败">

            

            
            <a href="/guides/v2.1/cloud/trouble/trouble_comp-deploy-fail.html">组件部署失败</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="redis问题排查">

            

            
            <a href="/guides/v2.1/cloud/trouble/redis-troubleshooting.html">Redis问题排查</a>
            

            
        </li>
        
        
        
        
        
        
        <li class="nav-level2  " id="解决加密密钥问题">

            

            
            <a href="/guides/v2.1/cloud/trouble/trouble-crypt-key-variable.html">解决加密密钥问题</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="解决html最小化问题">

            

            
            <a href="/guides/v2.1/cloud/trouble/trouble-error-html-minification.html">解决HTML最小化问题</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="解决部署期间的google分析问题">

            

            
            <a href="/guides/v2.1/cloud/trouble/trouble-google-analytics-deploy.html">解决部署期间的google分析问题</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="恢复配置文件">

            

            
            <a href="/guides/v2.1/cloud/trouble/restore-configuration-files.html">恢复配置文件</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="站点可用性">

            

            
            <a href="/guides/v2.1/cloud/trouble/site-availability.html">站点可用性</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="添加站点地图和搜索引擎的robots文件">

            

            
            <a href="/guides/v2.1/cloud/trouble/robots-sitemap.html">添加站点地图和搜索引擎的robots文件</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="主题问题排查">

            

            
            <a href="/guides/v2.1/cloud/trouble/theme-troubleshooting.html">主题问题排查</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="消息队列">

            

            
            <a href="/guides/v2.1/cloud/trouble/message-queues.html">消息队列</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="升级和补丁">
    

    
    <a href="/guides/v2.1/cloud/project/project-upgrade-parent.html">升级和补丁</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="patch-cloud工具">

            

            
            <a href="/guides/v2.1/cloud/composer-packages/ece-tools.html">Patch Cloud工具</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="magento企业版(云支持版)补丁">

            

            
            <a href="/guides/v2.1/cloud/project/project-patch.html">Magento企业版(云支持版)补丁</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="magento企业版(云支持版)升级">

            

            
            <a href="/guides/v2.1/cloud/project/project-upgrade.html">Magento企业版(云支持版)升级</a>
            

            
        </li>
        
        
        
        
    </ul>
    
</li>


		    
		    </ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

  <nav class="breadcrumbs">

    <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      <li class="breadcrumb-item"><a class="breadcrumb-item" href="/guides/v2.1/"><span>首页</span></a></li>

    <!-- Iteration breadcrumb item -->
    
    

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">

        
          <a property="item" typeof="WebPage" href="/guides/v2.1/cloud/bk-cloud.html">
            <span property="name">欢迎使用Magento企业版(云支持版)</span>
          </a>
        

        <meta property="position" content="1" />
      </li>

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item active" property="itemListElement" typeof="ListItem">

        

          

          <span property="name">部署代码并迁移静态文件和数据</span>

        

        <meta property="position" content="2" />
      </li>

    

    </ol>

  </nav>



	

	

	<h1 class="page-heading">部署代码并迁移静态文件和数据</h1>

  


</section>

			<h4 id="前提">前提:</h4>
<p><a href="/guides/v2.1/cloud/live/stage-prod-migrate-prereq.html">准备部署准生产和生产环境</a></p>

<p>To migrate your database and static files to Staging and Production:</p>

<ul>
  <li><a href="#code">Deploy code</a></li>
  <li><a href="#cloud-live-migrate-static">Migrate static files</a></li>
  <li><a href="#cloud-live-migrate-db">Migrate the database</a></li>
</ul>

<p>If you encounter errors or need to make changes, complete those updates on your local. Push the code changes to the Integration environment. Deploy the updated <code class="highlighter-rouge">master</code> branch again. See instructions in the <a href="/guides/v2.1/cloud/live/stage-prod-migrate.html">previous step</a>.</p>

<h2 id="code">Deploy code to Staging and Production</h2>
<p>You can also use the <a href="#interface">Project Web Interface</a> or <a href="#ssh">SSH and CLI commands</a> to deploy your code to Staging and Production.</p>

<h3 id="interface">Deploy code with the Project Web Interface</h3>
<p>The Project Web Interface provides full features to create, manage, and deploy code branches in your Integration, Staging, and Production environments for Starter and Pro plans.</p>

<p>For Pro projects created <strong>after October 23, 2017</strong> or <a href="/guides/v2.1/cloud/trouble/pro-env-management.html">updated</a>, deploy the Integration <code class="highlighter-rouge">master</code> branch you created to Staging and Production:</p>

<ol>
  <li><a href="https://accounts.magento.cloud">登录</a>到你的项目.</li>
  <li>Select the Integration branch.</li>
  <li>选择 <strong>合并</strong> 选项部署到准生产环境。 Complete all testing.</li>
  <li>选项准生产环境的分支。</li>
  <li>选择 <strong>合并</strong> 选项部署到生产环境。</li>
</ol>

<div>

  <div class="bs-callout bs-callout-info" id="info">
    <p><strong>Updating your Pro project</strong>: These sections include instructions for Pro projects with Staging and Production available in the Project Web Interface. To add Staging and Production to your interface, see <a href="/guides/v2.1/cloud/trouble/pro-env-management.html">Add Staging and Production to Pro projects UI</a>.</p>

    <p>We can update Pro projects created before October 23, 2017. All new Pro projects include these features. Your ticket will be queued for update, which may take time to complete. We will keep you updated through the process.</p>

    <p>If you do not request this update, you must use CLI commands or tickets to modify settings, variables, routes, and more for Pro plan Staging and Production environments.</p>
  </div>

  <p>For Starter, deploy your development branch you created to Staging and Production:</p>

  <ol>
    <li><a href="https://accounts.magento.cloud">登录</a>到你的项目.</li>
    <li>Select the prepared code branch.</li>
    <li>选择 <strong>合并</strong> 选项部署到准生产环境。 Complete all testing.</li>
    <li>选项准生产环境的分支。</li>
    <li>选择 <strong>合并</strong> 选项部署到生产环境。</li>
  </ol>

  <p><img src="http://devdocs.magento.com/common/images/cloud_project-merge.png" alt="使用合并选项部署" /></p>

  <h3 id="ssh">Deploy code with SSH and CLI</h3>
  <p>如果你更喜欢使用命令行来部署，你将必须配置附加的SSH设置和Git仓库来使用命令。你可以SSH登录到准生产环境和生产环境来推送<code class="highlighter-rouge">master</code>分支。</p>

  <p>You’ll need the SSH and Git access information for your project.</p>

  <ul>
    <li>For Starter projects, locate the SSH and Git information through the Project Web Interface.</li>
    <li>For Pro projects created <strong>after October 23, 2017</strong> or <a href="/guides/v2.1/cloud/trouble/pro-env-management.html">updated</a>, locate the SSH and Git information through the Project Web Interface.</li>
    <li>
      <p>For Pro projects created <strong>before October 23, 2017</strong>, the formats are as follows:</p>

      <ul>
        <li>
          <p>Git URL格式:</p>

          <ul>
            <li>准生产环境: <code class="highlighter-rouge">git@git.ent.magento.cloud:&lt;project ID&gt;_stg.git</code></li>
            <li>生产环境: <code class="highlighter-rouge">git@git.ent.magento.cloud:&lt;project ID&gt;.git</code></li>
          </ul>
        </li>
        <li>
          <p>SSH URL格式:</p>

          <ul>
            <li>准生产环境: <code class="highlighter-rouge">&lt;project ID&gt;_stg@&lt;project ID&gt;.ent.magento.cloud</code></li>
            <li>生产环境: <code class="highlighter-rouge">&lt;project ID&gt;@&lt;project ID&gt;.ent.magento.cloud</code></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <h4 id="classic">Deploy to Pro: updated or created after October 23, 2017</h4>
  <p>To deploy to Pro projects <strong>created after October 23, 2017</strong> or <a href="/guides/v2.1/cloud/trouble/pro-env-management.html">updated</a>:</p>

  <ol>
    <li>Open an SSH connection to your Staging or Production environment using the SSH command.</li>
    <li>
      <p>Checkout your Staging or Production branch:</p>

      <ul>
        <li>准生产环境: <code class="highlighter-rouge">git checkout staging</code></li>
        <li>生产环境: <code class="highlighter-rouge">git checkout production</code></li>
      </ul>
    </li>
    <li>
      <p>Pull the <code class="highlighter-rouge">master</code> branch from Integration. Remember, a pull performs a fetch and a merge in one step.</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   git pull origin master
</code></pre></div>      </div>

      <p>You merge this code as <code class="highlighter-rouge">staging</code> and <code class="highlighter-rouge">production</code> are branches of <code class="highlighter-rouge">master</code>.</p>
    </li>
    <li>
      <p>To fully update all code, then perform a push:</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   git push origin
</code></pre></div>      </div>
    </li>
  </ol>

  <h4 id="classic">Deploy to Pro: created before October 23, 2017</h4>
  <p>For these environments, you are pushing code from repository to repository: Integration <code class="highlighter-rouge">master</code> to Staging or Production <code class="highlighter-rouge">master</code>. Due to these being <code class="highlighter-rouge">master</code> branches in different repositories, you cannot merge as if branch to branch. You should have completed all <a href="/guides/v2.1/cloud/live/stage-prod-migrate-prereq.html">prerequisites</a> prior to deployment.</p>

  <ol>
    <li>Open an SSH connection to your Staging or Production environment using the SSH command.</li>
    <li>
      <p>拉取<code class="highlighter-rouge">master</code>分支到服务器。</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   git pull origin master
</code></pre></div>      </div>
    </li>
    <li>
      <p>Merge changes to Staging or Production:</p>

      <ul>
        <li>准生产环境: <code class="highlighter-rouge">git push staging master:master</code></li>
        <li>生产环境: <code class="highlighter-rouge">git push production master:master</code></li>
      </ul>

      <p>You must force push for these branches as they are separate repositories with a <code class="highlighter-rouge">master</code> branch.</p>
    </li>
  </ol>

  <h2 id="cloud-live-migrate-static">Migrate static files</h2>
  <p>You will migrate <span term-uuid="363662cb-73f1-4347-a15e-2d2adabeb0c2" class="glossary-term" data-toggle="popover">static files</span> from your <code class="highlighter-rouge">pub/media</code> directory to Staging or Production.</p>

  <p>We recommend using the Linux remote synchronization and file transfer command <a href="https://en.wikipedia.org/wiki/Rsync" target="_blank"><code class="highlighter-rouge">rsync</code></a>. rsync uses an algorithm that minimizes the amount of data by moving only the portions of files that have changed; in addition, it supports compression.</p>

  <p>We suggest using the following syntax:</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rsync -azvP &lt;source&gt; &lt;destination&gt;
</code></pre></div>  </div>

  <p>Options:</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a archive
z compress
v verbose
P partial progress
</code></pre></div>  </div>

  <p>For additional options, see the <a href="http://linux.die.net/man/1/rsync" target="_blank">rsync man page</a>.</p>

  <p>To migrate static files:</p>

  <ol>
    <li>
      <p>Open an SSH connection to your Staging or Production environment:</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    *	准生产环境: ssh -A &lt;project ID&gt;_stg@&lt;project ID&gt;.ent.magento.cloud
    *	生产环境: ssh -A &lt;project ID&gt;@&lt;project ID&gt;.ent.magento.cloud
</code></pre></div>      </div>
    </li>
    <li>
      <p>rsync the <code class="highlighter-rouge">pub/media</code> directory from your local Magento server to staging or production:</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rsync -azvP pub/media/ &lt;developmemt machine user name&gt;@&lt;development machine host or IP&gt;:pub/media/
</code></pre></div>      </div>
    </li>
  </ol>

  <p>The IP is for the Magento Commerce VM or container you created when setting up the local.</p>

  <h2 id="cloud-live-migrate-db">Dump and migrate the database</h2>

  <p><strong>Prerequisite:</strong> A database dump (see 步骤3. should include database triggers. For dumping them, make sure you have the <a href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_trigger" target="_blank">TRIGGER privilege</a>.</p>

  <p><strong>重要:</strong> The Integration environment database is strictly for development testing and may include data you may not want to migrate into Staging and Production.</p>

  <p>For continuous integration deployments, we <strong>do not recommend</strong> migrating data from Integration to Staging and Production. You could pass testing data or overwrite important data. Any vital configurations will be passed using the <a href="/guides/v2.1/cloud/live/sens-data-over.html">configuration file</a> and <code class="highlighter-rouge">setup:upgrade</code> command during build and deploy.</p>

  <p>We <strong>do recommend</strong> migrating data from Production into Staging to fully test your site and store(s) in a near-production environment with all services and settings.</p>

  <p>To migrate a database:</p>

  <ol>
    <li>
      <p>SSH into the environment you want to create a database dump from:</p>

      <ul>
        <li>准生产环境: <code class="highlighter-rouge">ssh -A &lt;project ID&gt;_stg@&lt;project ID&gt;.ent.magento.cloud</code></li>
        <li>生产环境: <code class="highlighter-rouge">ssh -A &lt;project ID&gt;@&lt;project ID&gt;.ent.magento.cloud</code></li>
        <li>
          <p>To SSH into the <code class="highlighter-rouge">master</code> branch of your Integration environment:</p>

          <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  magento-cloud environment:ssh
</code></pre></div>          </div>
        </li>
      </ul>
    </li>
    <li>
      <p>Find the database login information with the following command:</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php -r 'print_r(json_decode(base64_decode($_ENV["MAGENTO_CLOUD_RELATIONSHIPS"]))-&gt;database);'
</code></pre></div>      </div>
    </li>
    <li>
      <p>Create a database dump. The following command creates a database dump as a gzip file.</p>

      <p>For Starter environments and Pro Integration environments:</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqldump -h &lt;database host&gt; --user=&lt;database user name&gt; --password=&lt;password&gt; --single-transaction --triggers main | gzip - &gt; /tmp/database.sql.gz
</code></pre></div>      </div>

      <p>For Pro Staging and Production environments, the name of the database is in the <code class="highlighter-rouge">MAGENTO_CLOUD_RELATIONSHIPS</code> variable (typically the same as the application name and user name):</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqldump -h &lt;database host&gt; --user=&lt;database user name&gt; --password=&lt;password&gt; --single-transaction --triggers &lt;database name&gt; | gzip - &gt; /tmp/database.sql.gz
</code></pre></div>      </div>
    </li>
    <li>
      <p>Transfer the database dump to Staging or Production with an <code class="highlighter-rouge">rsync</code> command:</p>

      <ul>
        <li>准生产环境: <code class="highlighter-rouge">rsync -azvP /tmp/database.sql.gz &lt;project ID&gt;_stg@&lt;project ID&gt;.ent.magento.cloud:/tmp</code></li>
        <li>生产环境: <code class="highlighter-rouge">rsync -azvP /tmp/database.sql.gz &lt;project ID&gt;@&lt;project ID&gt;.ent.magento.cloud:/tmp</code></li>
      </ul>
    </li>
    <li>Enter <code class="highlighter-rouge">exit</code> to terminate the SSH connection.</li>
    <li>
      <p>Open an SSH connection to the environment you want to migrate the database into:</p>

      <ul>
        <li>准生产环境: <code class="highlighter-rouge">ssh -A &lt;project ID&gt;_stg@&lt;project ID&gt;.ent.magento.cloud</code></li>
        <li>生产环境: <code class="highlighter-rouge">ssh -A &lt;project ID&gt;@&lt;project ID&gt;.ent.magento.cloud</code></li>
        <li>
          <p>To SSH into the <code class="highlighter-rouge">master</code> branch of your Integration environment:</p>

          <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  magento-cloud environment:ssh
</code></pre></div>          </div>
        </li>
      </ul>
    </li>
    <li>
      <p>Import the database dump with the following command:</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zcat database.sql.gz | mysql -u &lt;username&gt; -p&lt;password&gt; &lt;database name&gt;
</code></pre></div>      </div>

      <p>The following is an example using information from step 2:</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zcat database.sql.gz | mysql -u user main
</code></pre></div>      </div>
    </li>
  </ol>

  <h3 id="the-database-migration">故障排除 the database migration</h3>
  <p>If you encounter the following error, you can try to create a database dump with the DEFINER replaced:</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ERROR 1277 (42000) at line &lt;number&gt;: Access denied; you need (at least one of) the SUPER privilege(s) for this operation
</code></pre></div>  </div>

  <p>This error occurs because the DEFINER for the triggers in the SQL dump is the production user. This user requires administrative permissions.</p>

  <p>To solve the issue, you can generate a new database dump changing or removing the <code class="highlighter-rouge">DEFINER</code> clause. The following is one example of completing this change:</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqldump <span class="nt">-h</span> &lt;database host&gt; <span class="nt">--user</span><span class="o">=</span>&lt;database user name&gt; <span class="nt">--password</span><span class="o">=</span>&lt;password&gt; <span class="nt">--single-transaction</span> main  | sed <span class="nt">-e</span> <span class="s1">'s/DEFINER[ ]*=[ ]*[^*]*\*/\*/'</span> | gzip <span class="o">&gt;</span> /tmp/database_no-definer.sql.gz
</code></pre></div>  </div>

  <p>Use the database dump you just created to <a href="#cloud-live-migrate-db">migrate the database</a>.</p>

  <div class="bs-callout bs-callout-info" id="info">
  <p>After migrating the database, you can set up your stored procedures or views in Staging or Production the same way you did in your Integration environment.</p>
</div>

  <h4 id="section">下一步</h4>
  <p><a href="/guides/v2.1/cloud/live/stage-prod-test.html">测试部署</a></p>
</div>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

    
  
    
    <div class="github-link">
      <a class="improve-page" href="https://github.com/magento/devdocs/blob/develop/guides/v2.1/cloud/live/stage-prod-migrate.md" target="_blank">
        去GitHub上编辑
      </a>
    </div>
    
  
    
    <div class="new-issue">
      <a href="https://github.com/magento/devdocs/issues/new?title=Feedback on page: /guides/v2.1/cloud/live/stage-prod-migrate.html" target="_blank">反馈</a>
    </div>
    
  
  </div>

	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav footer-links">
  <li><a href="/guides/v2.1/contributor-guide/contributing_docs.html">成为贡献者</a>
  <li><a href="https://magento.github.io/glossary/index.html?audience=developer">术语表</a></li>
  <li><a href="http://magento.com/legal/terms/privacy/">隐私政策</a></li>
  <li><a href="http://magento.com/legal/terms/">服务条款</a></li>
  <li><a href="http://magento.com/legal/licensing/">许可/商标 常见问题</a></li>
  <li><a href="/guides/v2.1/release-notes/bk-release-notes.html">版本日志</a></li>
  <li><a href="/magento-third-party.html">三方许可</a></li>
</ul>

    </div>

		<div class="copyright-date">&copy; 2018 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/assets/js/app.min.js"></script>


<script src="/common/js/devdocs.min.js"></script>




</body>
</html>

